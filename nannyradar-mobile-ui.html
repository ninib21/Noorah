<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>NannyRadar - Mobile App</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            height: 100%;
            overflow: hidden; /* hide browser scrollbars */
            font-family: 'Nunito', sans-serif;
            background: #1a1a1a;
            color: #2C3E50;
            -webkit-user-select: none;
            user-select: none;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
            padding: 0; /* remove outer padding that can show background edges */
        }

        /* Theme tokens */
        :root {
            --bg: #FFFFFF;
            --text: #2C3E50;
            --muted: #7F8C8D;
            --card: #FFFFFF;
            --border: #E8E8E8;
            --nav: #FFFFFF;
        }
        [data-theme="dark"] {
            --bg: #0f1420;
            --text: #E6EAF2;
            --muted: #A3B1C6;
            --card: #141a26;
            --border: #263041;
            --nav: #0f1420;
        }

        /* Theme toggle button */
        .theme-toggle {
            position: absolute;
            top: 14px;
            right: 14px;
            width: 38px;
            height: 38px;
            border-radius: 50%;
            border: none;
            background: rgba(255,255,255,0.9);
            color: #FF69B4;
            box-shadow: 0 6px 16px rgba(0,0,0,0.2);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            z-index: 1002;
            cursor: pointer;
        }
        [data-theme="dark"] .theme-toggle { background: rgba(20,26,38,0.9); color: #FFD166; }


        .phone-frame {
            width: 375px;
            height: 812px;
            background: #000;
            border-radius: 40px;
            padding: 8px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            position: relative;
            overflow: hidden; /* ensure nothing spills out */
            isolation: isolate; /* clip pseudo-elements/shadows inside */
        }

        .phone-frame::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 6px;
            background: #333;
            border-radius: 3px;
            z-index: 1001;
        }

        .mobile-container {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden; /* container stays clipped */
            background: var(--bg);
            border-radius: 32px;
            color: var(--text);
        }

        .screen {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            background: white;
            overflow-y: auto; /* allow scroll */
            overflow-x: hidden; /* keep all content inside the phone */
            -webkit-overflow-scrolling: touch; /* smooth touch scrolling */
            transform: translateX(100%);
            pointer-events: none; /* disable interactions on non-active screens */
        }

        /* Hide scrollbars (tracks) globally to prevent white bars inside the phone */
        .phone-frame, .phone-frame * { -ms-overflow-style: none; scrollbar-width: none; }
        .phone-frame::-webkit-scrollbar,
        .phone-frame *::-webkit-scrollbar { width: 0 !important; height: 0 !important; display: none !important; background: transparent; }
        body, .mobile-container, .screen { -ms-overflow-style: none; scrollbar-width: none; }
        body::-webkit-scrollbar, .mobile-container::-webkit-scrollbar, .screen::-webkit-scrollbar { width: 0 !important; height: 0 !important; display: none !important; background: transparent; }

        .screen.active {
            transform: translateX(0);
            pointer-events: auto; /* only active screen receives clicks/taps */
            z-index: 2;
        }

        .screen.next {
            transform: translateX(100%);
        }

        .screen.prev {
            transform: translateX(-100%);
        }


        /* Global Back Button */
        .back-btn {
            position: sticky; /* move with scroll within each screen */
            top: 18px;
            left: 18px;
            width: 42px;
            height: 42px;
            border-radius: 50%;
            border: none;
            background: rgba(255,255,255,0.9);
            color: #FF69B4;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            z-index: 5;
            cursor: pointer;
            pointer-events: auto;
            backdrop-filter: blur(8px);
            -webkit-tap-highlight-color: transparent;
            margin-left: 6px;
        }
        .back-btn:active { transform: scale(0.95); }


        /* Landing Page Styles */
        .landing {
            background: linear-gradient(135deg, #FF69B4 0%, #87CEEB 100%);
            color: white;
            text-align: center;
            padding: 60px 30px 40px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 100vh;
        }

        .logo {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 15px;
            margin-top: 40px;
        }

        .tagline {
            font-size: 1.3rem;
            opacity: 0.95;
            margin-bottom: 60px;
            line-height: 1.4;
        }

        .hero-image, .emoji-wrap, .overlay, .radial, .gradient, .decorative {
            width: 250px;
            height: 250px;
            background: rgba(255,255,255,0.15);
            border-radius: 50%;
            margin: 0 auto 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 5rem;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        /* Soft frosted circle used on landing hero */
        .soft-hero-circle {
            position: relative;
            width: 220px;
            height: 220px;
            margin: 0 auto 20px;
            border-radius: 50%;
            background: radial-gradient(120px 120px at 40% 35%, rgba(255,255,255,0.9), rgba(255,255,255,0.55) 60%, rgba(255,255,255,0.35) 80%, rgba(255,255,255,0.2) 100%);
            box-shadow:
                0 30px 60px rgba(0, 0, 0, 0.15),
                inset 0 -10px 30px rgba(0, 0, 0, 0.08),
                inset 0 8px 18px rgba(255, 255, 255, 0.5);
            overflow: hidden;
            isolation: isolate;
        }
        .soft-hero-circle::before {
            content: '';
            position: absolute;
            inset: -30px; /* feathered outer glow */
            border-radius: 50%;
            background: radial-gradient(55% 55% at 50% 45%, rgba(255,255,255,0.6), rgba(255,255,255,0.2) 60%, rgba(255,255,255,0.0) 75%);
            filter: blur(6px);
            z-index: -1;
        }
        .soft-hero-circle::after {
            content: '';
            position: absolute;
            top: 12%;
            left: 22%;
            width: 56%;
            height: 56%;
            border-radius: 50%;
            background: radial-gradient(60% 60% at 30% 30%, rgba(255,255,255,0.9), rgba(255,255,255,0.35) 70%, rgba(255,255,255,0.0) 100%);
            filter: blur(8px);
            opacity: 0.85; /* inner highlight */
        }
        .soft-hero-content {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .soft-hero-babies {
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateY(4px);
        }
        .soft-hero-baby { /* emoji size inside circle (fallback) */
            font-size: 2.2rem;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.12));
        }
        .soft-hero-avatar {
            width: 62px;
            height: 62px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid rgba(255,255,255,0.9);
            box-shadow: 0 8px 18px rgba(0,0,0,0.18);
            background: #f2f2f2;
        }
        @media (min-width: 400px) {
            .soft-hero-baby { font-size: 2.6rem; }
            .soft-hero-avatar { width: 70px; height: 70px; }
        }

        .cta-buttons {
            margin-bottom: 40px;
        }

        .btn {
            display: block;
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 30px;
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Nunito', sans-serif;
        }

        .btn-primary {
            background: white;
            color: #FF69B4;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 2px solid rgba(255,255,255,0.8);
        }

        .btn:active {
            transform: scale(0.98);
        }
        /* Make decorative layers ignore taps and buttons clickable above */
        .hero-image, .emoji-wrap, .overlay, .radial, .gradient, .decorative {
            pointer-events: none !important; /* do not block button taps */
        }
        .btn { position: relative; z-index: 10; pointer-events: auto; touch-action: manipulation; -webkit-tap-highlight-color: transparent; }


        /* Login/Signup Styles */
        .auth-screen {
            padding: 60px 30px 40px;
            text-align: center;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .auth-logo {
            font-size: 2.5rem;
            font-weight: 800;
            color: #FF69B4;
            margin-bottom: 50px;
        }

        .form-group {
            margin-bottom: 25px;
            text-align: left;
        }

        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #2C3E50;
            font-size: 1rem;
        }

        .form-input {
            width: 100%;
            padding: 18px;
            border: 2px solid #F0F0F0;
            border-radius: 15px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            font-family: 'Nunito', sans-serif;
            background: #FAFAFA;
        }

        .form-input:focus {
            outline: none;
            border-color: #FF69B4;
            background: white;
            box-shadow: 0 0 0 3px rgba(255,105,180,0.1);
        }

        .social-login {
            display: flex;
            gap: 15px;
            margin: 30px 0;
        }

        .social-btn {
            flex: 1;
            padding: 15px;
            border: 2px solid #F0F0F0;
            border-radius: 15px;
            background: white;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .social-btn:active {
            transform: scale(0.95);
        }

        /* Dashboard Styles */
        .dashboard {
            padding: 20px;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .greeting {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2C3E50;
        }

        .notification-icon {
            width: 40px;
            height: 40px;
            background: #FF69B4;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .booking-card {
            background: linear-gradient(135deg, #FF69B4, #87CEEB);
            border-radius: 20px;
            padding: 20px;
            color: white;
            margin-bottom: 30px;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .action-btn {
            background: white;
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: none;
            cursor: pointer;
        }

        .action-icon {
            font-size: 2rem;
            color: #FF69B4;
            margin-bottom: 10px;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--nav);
            padding: 15px;
            display: flex;
            justify-content: space-around;
            box-shadow: 0 -4px 12px rgba(0,0,0,0.1);
        }

        .nav-item {
            text-align: center;
            color: #7F8C8D;
            font-size: 0.8rem;
        }

        .nav-item.active {
            color: #FF69B4;
        }

        .nav-icon {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }
        /* Button Styles */
        .btn {
            display: block;
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 30px;
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Nunito', sans-serif;
            touch-action: manipulation;
            position: relative;
            overflow: hidden;
        }

        .btn:active {
            transform: scale(0.96);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            transition: width 0.3s, height 0.3s;
            transform: translate(-50%, -50%);
            z-index: 1;
        }

        .btn:active::before {
            width: 300px;
            height: 300px;
        }

        /* Progress bar for onboarding */
        .progress-wrap{ display:flex; align-items:center; gap:10px; margin:8px 0 6px; }
        .progress-bar{ flex:1; height:8px; background:#EEE; border-radius:6px; overflow:hidden; }
        .progress-fill{ height:100%; width:0%; background: linear-gradient(90deg,#FF69B4,#87CEEB); transition: width 0.3s ease; }
        .progress-label{ color:#7F8C8D; font-size:0.9rem; min-width:86px; text-align:right; }


        .btn-primary {
            background: #FF69B4;
            color: white;
            box-shadow: 0 8px 25px rgba(255,105,180,0.3);
        }

        .btn-secondary {
            background: #87CEEB;
            color: white;
            box-shadow: 0 8px 25px rgba(135,206,235,0.3);
        }

        .btn-outline {
            background: transparent;
            color: #FF69B4;
            border: 2px solid #FF69B4;
        }

        /* Form Styles */
        .form-input {
            width: 100%;
            padding: 18px;
            border: 2px solid #F0F0F0;
            border-radius: 15px;
            font-size: 1rem;
            font-family: 'Nunito', sans-serif;
            background: white;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #FF69B4;
            box-shadow: 0 0 0 3px rgba(255,105,180,0.1);
        }

        /* Card Styles */
        .card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .gradient-card {
            background: linear-gradient(135deg, #FF69B4, #87CEEB);
            color: white;
        }

        /* Responsive */
        @media (max-width: 375px) {
            .btn {
                padding: 16px;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>

    <div class="phone-frame">
        <div class="mobile-container">
        <!-- Screen 1: Landing Page -->
        <div class="screen active" id="screen-0">
            <div style="background: linear-gradient(135deg, #FF69B4 0%, #87CEEB 100%); color: white; text-align: center; padding: 40px 24px 64px; display: flex; flex-direction: column; justify-content: space-between; height: 100%;">


                <div>
                    <div style="font-size: 2.4rem; font-weight: 800; margin-bottom: 12px; margin-top: 12px;">🍼 NannyRadar</div>
                    <div style="font-size: 1.2rem; opacity: 0.95; margin-bottom: 24px; line-height: 1.4;">Find trusted babysitters in your neighborhood</div>
                    <div class="soft-hero-circle">
                            <div class="soft-hero-content">
                                <span class="soft-hero-baby" aria-label="Baby">👶</span>
                            </div>
                        </div>
                </div>
                <div>
                    <button id="btnGetStarted" class="btn" style="background: #FF69B4; color: white; box-shadow: 0 8px 25px rgba(0,0,0,0.15); margin-bottom: 8px; transform: translateY(-8px);" data-action="auth" data-role="parent">Parent Portal</button>
                    <button id="btnSitter" class="btn" style="background: #87CEEB; color: white; border: none; box-shadow: 0 8px 25px rgba(0,0,0,0.15); margin-bottom: 0; transform: translateY(-8px);" data-action="auth" data-role="sitter">Sitter Portal</button>
                    <div style="margin-top: 12px; font-size: 0.95rem; opacity: 0.85;">
                        📱 Available on App Store & Google Play
                    </div>
                </div>
            </div>
        </div>


        <!-- Screen 2: Login/Sign Up -->
        <div class="screen next" id="screen-1">

            <button class="back-btn" data-action="back" aria-label="Go back"><i class="fas fa-arrow-left"></i></button>

            <div style="padding: 24px 24px 16px; text-align: center; display: flex; flex-direction: column; justify-content: flex-start; gap: 12px; background: #FAFAFA;">
                <div style="font-size: 2rem; font-weight: 800; color: #FF69B4; margin-bottom: 16px;">🍼 NannyRadar</div>

                <div style="margin-bottom: 25px; text-align: left;">
                    <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #2C3E50; font-size: 1rem;">Email</label>
                    <input type="email" class="form-input" placeholder="Enter your email" id="email-input">
                </div>

                <div style="margin-bottom: 25px; text-align: left;">

            <!-- Quick jumper for debugging: visible only if sitter onboarding not found -->
            <div id="sitter-onboarding-fallback" style="display:none; padding:10px; background:#FFF3CD; color:#7C2D12; border:1px solid #FEEBC8; border-radius:8px; margin:10px;">
                Having trouble? <button class="btn" style="background:#6C63FF; color:white; padding:6px 10px;" onclick="showScreenById('screen-10')">Start Sitter Onboarding</button>
            </div>

                    <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #2C3E50; font-size: 1rem;">Password</label>
                    <input type="password" class="form-input" placeholder="Enter your password" id="password-input">
                </div>

                <button class="btn btn-primary" style="background: #FF69B4; color: white; margin-bottom: 16px; transition: transform 0.2s;" onclick="handleLogin()" ontouchstart="this.style.transform='scale(0.98)'" ontouchend="this.style.transform='scale(1)'">
                    Sign In
                </button>

                <div style="display: flex; gap: 10px; margin: 12px 0;">
                    <button style="flex: 1; padding: 12px; border: 2px solid #F0F0F0; border-radius: 12px; background: white; font-size: 1.2rem; cursor: pointer; transition: transform 0.2s;" onclick="handleGoogleLogin()" ontouchstart="this.style.transform='scale(0.95)'" ontouchend="this.style.transform='scale(1)'">
                        <i class="fab fa-google" style="color: #DB4437;"></i>
                    </button>
                    <button style="flex: 1; padding: 12px; border: 2px solid #F0F0F0; border-radius: 12px; background: white; font-size: 1.2rem; cursor: pointer; transition: transform 0.2s;" onclick="handleFacebookLogin()" ontouchstart="this.style.transform='scale(0.95)'" ontouchend="this.style.transform='scale(1)'">
                        <i class="fab fa-facebook" style="color: #4267B2;"></i>


                    </button>
                    <button style="flex: 1; padding: 12px; border: 2px solid #F0F0F0; border-radius: 12px; background: white; font-size: 1.2rem; cursor: pointer; transition: transform 0.2s;" onclick="handleAppleLogin()" ontouchstart="this.style.transform='scale(0.95)'" ontouchend="this.style.transform='scale(1)'">
                        <i class="fab fa-apple" style="color: #000;"></i>
                    </button>
                </div>

                <p style="margin-top: 12px; font-size: 0.95rem; color: #2C3E50;">
                    Create an account <span style="color: #FF69B4; font-weight: 700; cursor: pointer;" onclick="showScreenById('screen-7')">Signup now</span>
                </p>

            </div>
        </div>


            <!-- Parent Dashboard -->

        <!-- Screen: Sign Up -->
        <div class="screen hidden" id="screen-7">
            <button class="back-btn" data-action="back" aria-label="Go back"><i class="fas fa-arrow-left"></i></button>

            <div style="padding: 24px 24px 16px; text-align: center; display: flex; flex-direction: column; justify-content: flex-start; gap: 12px; background: #FAFAFA;">
                <div style="font-size: 2rem; font-weight: 800; color: #FF69B4; margin-bottom: 8px;">Create Account</div>
                <p style="color:#7F8C8D; margin:0 0 16px;">Join NannyRadar in seconds</p>

                <div style="margin-bottom: 16px; text-align: left;">
                    <label style="display:block; margin-bottom: 8px; font-weight:600; color:#2C3E50;">Full Name</label>
                    <input type="text" class="form-input" placeholder="Your name" id="signup-name">
                </div>
                <div style="margin-bottom: 16px; text-align: left;">
                    <label style="display:block; margin-bottom: 8px; font-weight:600; color:#2C3E50;">Email</label>
                    <input type="email" class="form-input" placeholder="you@example.com" id="signup-email">
                </div>
                <div style="margin-bottom: 16px; text-align: left;">
                    <label style="display:block; margin-bottom: 8px; font-weight:600; color:#2C3E50;">Password</label>
                    <input type="password" class="form-input" placeholder="Create a password" id="signup-password">
                </div>
                <div style="margin-bottom: 8px; text-align: left;">
                    <label style="display:block; margin-bottom: 8px; font-weight:600; color:#2C3E50;">Confirm Password</label>
                    <input type="password" class="form-input" placeholder="Re-enter password" id="signup-password2">
                </div>

                <button class="btn btn-primary" style="background:#FF69B4; color:white; margin-top: 8px;" onclick="createAccount()">Create Account</button>
                <p style="margin: 8px 0 0; color:#7F8C8D; font-size:0.95rem;">Already have an account? <span style="color:#FF69B4; font-weight:700; cursor:pointer;" onclick="showScreenById('screen-1')">Sign in</span></p>
            </div>
        </div>

        <!-- Screen: Onboarding Step 1 - Choose Role -->
        <div class="screen hidden" id="screen-8">
            <button class="back-btn" data-action="back" aria-label="Go back"><i class="fas fa-arrow-left"></i></button>
            <div style="padding: 28px; background: #FAFAFA; min-height: 100%; display:flex; flex-direction:column; gap:16px;">
                <h2 style="text-align:center; color:#2C3E50; margin: 8px 0 4px;">Welcome! Who are you?</h2>
                <p style="text-align:center; color:#7F8C8D; margin-bottom: 8px;">Choose your role to personalize your experience.</p>
                <div style="display:flex; gap:12px;">
                    <button id="btnRoleParent" class="btn" style="flex:1; background:#FF69B4; color:white;" data-action="choose-role" data-role="parent">I'm a Parent</button>
                    <button id="btnRoleSitter" class="btn" style="flex:1; background:#87CEEB; color:white;" data-action="choose-role" data-role="sitter">I'm a Sitter</button>
                </div>
            </div>
        </div>

        <!-- Screen: Onboarding Step 2 - Extra Info -->
        <div class="screen hidden" id="screen-9">
            <button class="back-btn" data-action="back" aria-label="Go back"><i class="fas fa-arrow-left"></i></button>
            <div style="padding: 28px; background:#FAFAFA; min-height:100%; display:flex; flex-direction:column; gap:14px;">
                <h2 id="onboard-title" style="text-align:center; color:#2C3E50; margin:8px 0 0;">Tell us a bit more</h2>
                <div id="parent-fields" style="display:none;">
                    <div style="margin-top: 4px; text-align:left;">
                        <label style="display:block; margin-bottom:8px; font-weight:600; color:#2C3E50;">Number of Children</label>
                        <input id="children-count" type="number" min="1" max="10" class="form-input" placeholder="e.g., 2" />
                    </div>
                    <div style="text-align:left;">
                        <label style="display:block; margin-bottom:8px; font-weight:600; color:#2C3E50;">City</label>
                        <input id="parent-city" type="text" class="form-input" placeholder="Your city" />
                    </div>
                </div>
                <div id="sitter-fields" style="display:none;">
                    <div style="margin-top: 4px; text-align:left;">
                        <label style="display:block; margin-bottom:8px; font-weight:600; color:#2C3E50;">Years of Experience</label>
                        <input id="sitter-experience" type="number" min="0" max="50" class="form-input" placeholder="e.g., 3" />
                    </div>
                    <div style="text-align:left;">
                        <label style="display:block; margin-bottom:8px; font-weight:600; color:#2C3E50;">Hourly Rate ($)</label>
                        <input id="sitter-rate" type="number" min="5" max="200" class="form-input" placeholder="e.g., 20" />
                    </div>
                </div>
                <button class="btn btn-primary" style="background:#6C63FF; color:white; margin-top:10px;" data-action="goto-screen" data-target="screen-10">Continue</button>
            </div>
        </div>

        <!-- Sitter Onboarding Wizard (condensed demo variant) -->
        <div class="screen hidden" id="screen-10">
            <button class="back-btn" data-action="back" aria-label="Go back"><i class="fas fa-arrow-left"></i></button>
            <div style="padding:24px; background:#FAFAFA; min-height:100%; display:flex; flex-direction:column; gap:14px;">
                <div class="progress-wrap">
                    <div class="progress-bar"><div id="sitter-progress" class="progress-fill" style="width:0%"></div></div>
                    <div id="sitter-progress-label" class="progress-label">Step 0/12</div>
                </div>
                <div style="text-align:center;">
                    <div style="font-size:1.6rem; font-weight:800; color:#2C3E50;">Welcome to NannyRadar, Sitter! 🎉</div>
                <style>
                    /* Hide marketing/design sections during onboarding */
                    .phone-mockup, [data-section="design-features"] { display:none !important; }
                </style>
                    <div style="color:#7F8C8D;">Let’s set up your profile so parents can trust and book you.</div>
                </div>
                <button id="sitter-get-started" class="btn" style="background:#6C63FF; color:white;" data-nav="sitter" data-step="1">Get Started</button>
                <script>
                    // Belt-and-suspenders: direct click, mousedown, and touch binding for Get Started
                    (function(){
                        function go(){ try{ gotoSitterStep(1); }catch(e){ try{ showScreenById('sitter-step-1'); }catch(_){} } }
                        function bind(){
                            const btn = document.getElementById('sitter-get-started');
                            if(!btn) return;
                            ['click','mousedown','touchend'].forEach(ev=>btn.addEventListener(ev,(e)=>{ e.preventDefault(); e.stopPropagation(); go(); }, {passive:false}));
                        }
                        if(document.readyState==='loading') document.addEventListener('DOMContentLoaded', bind); else bind();
                    })();
                </script>


        <!-- Sitter Step 1: Basic Info -->
        <div class="screen hidden" id="screen-11">
            <button class="back-btn" data-action="back" aria-label="Go back"><i class="fas fa-arrow-left"></i></button>
            <div style="padding:24px; background:#FAFAFA; min-height:100%; display:flex; flex-direction:column; gap:12px;">
                <div class="progress-wrap">
                    <div class="progress-bar"><div class="progress-fill" style="width:25%"></div></div>
                    <div class="progress-label">Step 1/4</div>
                </div>
                <h2 style="text-align:center; color:#2C3E50;">Basic Information</h2>
                <input id="si-fullname" class="form-input" placeholder="Full Name" />
                <input id="si-nickname" class="form-input" placeholder="Preferred Name/Nickname" />
                <input id="si-dob" class="form-input" type="date" placeholder="Date of Birth" />
                <input id="si-city" class="form-input" placeholder="City" />
                <input id="si-state" class="form-input" placeholder="State" />
                <input id="si-phone" class="form-input" placeholder="Phone Number" />
                <input id="si-email" class="form-input" placeholder="Email Address" />
                <label style="display:flex; align-items:center; gap:8px; color:#2C3E50;"><input id="si-privacy" type="checkbox" /> Show only my first name to parents until booked</label>
                <button class="btn" style="background:#6C63FF; color:white;" data-nav="sitter" data-step="2">Next →</button>
            </div>
        </div>

        <!-- Sitter Step 2: Identity Verification (simplified demo) -->
        <div class="screen hidden" id="sitter-step-2">
            <button class="back-btn" data-action="back" aria-label="Go back"><i class="fas fa-arrow-left"></i></button>
            <div style="padding:24px; background:#FAFAFA; min-height:100%; display:flex; flex-direction:column; gap:12px;">
                <div class="progress-wrap">
                    <div class="progress-bar"><div class="progress-fill" style="width:50%"></div></div>
                    <div class="progress-label">Step 2/4</div>
                </div>
                <h2 style="text-align:center; color:#2C3E50;">Profile & Identity Verification</h2>
                <button class="btn" style="background:white; border:2px dashed #E8E8E8; color:#2C3E50;">Upload Profile Photo</button>
                <button class="btn" style="background:white; border:2px dashed #E8E8E8; color:#2C3E50;">Upload ID (Driver’s License/Passport)</button>
                <button class="btn" style="background:white; border:2px dashed #E8E8E8; color:#2C3E50;">Take Selfie</button>
                <label style="display:flex; align-items:center; gap:8px; color:#2C3E50;"><input id="si-consent" type="checkbox" /> I agree to background checks.</label>
                <button class="btn" style="background:#6C63FF; color:white;" data-nav="sitter" data-step="3">Verify Me</button>
            </div>
        </div>

        <!-- Sitter Step 3: Experience & Skills (condensed) -->
        <div class="screen hidden" id="sitter-step-3">
            <button class="back-btn" data-action="back" aria-label="Go back"><i class="fas fa-arrow-left"></i></button>
            <div style="padding:24px; background:#FAFAFA; min-height:100%; display:flex; flex-direction:column; gap:12px;">
                <div class="progress-wrap">
                    <div class="progress-bar"><div class="progress-fill" style="width:75%"></div></div>
                    <div class="progress-label">Step 3/4</div>
                </div>
                <h2 style="text-align:center; color:#2C3E50;">Experience & Skills</h2>
                <select id="si-years" class="form-input">
                    <option value="0">No experience yet</option>
                    <option value="1">1 year</option>
                    <option value="2">2 years</option>
                    <option value="3">3 years</option>
                    <option value="4">4+ years</option>
                </select>
                <div style="display:grid; grid-template-columns:repeat(2, 1fr); gap:8px; color:#2C3E50;">
                    <label><input type="checkbox" class="si-skill" value="infants" /> Infants 👶</label>
                    <label><input type="checkbox" class="si-skill" value="toddlers" /> Toddlers 🚼</label>
                    <label><input type="checkbox" class="si-skill" value="preschoolers" /> Preschoolers 🧸</label>
                    <label><input type="checkbox" class="si-skill" value="school-age" /> School-age 📚</label>
                    <label><input type="checkbox" class="si-skill" value="preteens" /> Pre-teens 🎮</label>
                </div>
                <input id="si-certs" class="form-input" placeholder="Certifications (e.g., CPR, First Aid)" />
                <input id="si-languages" class="form-input" placeholder="Languages you speak" />
                <button class="btn" style="background:#6C63FF; color:white;" data-nav="sitter" data-step="4">Next →</button>
            </div>
        </div>

        <!-- Sitter Step 4: Availability & Rates (condensed demo) -->
        <div class="screen hidden" id="sitter-step-4">
            <button class="back-btn" data-action="back" aria-label="Go back"><i class="fas fa-arrow-left"></i></button>
            <div style="padding:24px; background:#FAFAFA; min-height:100%; display:flex; flex-direction:column; gap:12px;">
                <div class="progress-wrap">
                    <div class="progress-bar"><div class="progress-fill" style="width:100%"></div></div>
                    <div class="progress-label">Step 4/4</div>
                </div>
                <h2 style="text-align:center; color:#2C3E50;">Availability & Rates</h2>
                <label style="color:#2C3E50;">Hourly rate ($)</label>
                <input id="si-rate" type="number" class="form-input" placeholder="e.g., 20" />
                <label style="display:flex; align-items:center; gap:8px; color:#2C3E50;"><input id="si-weekend" type="checkbox" /> Weekend/Holiday rates</label>
                <label style="display:flex; align-items:center; gap:8px; color:#2C3E50;"><input id="si-overnight" type="checkbox" /> Available for Overnight Care</label>
                <label style="display:flex; align-items:center; gap:8px; color:#2C3E50;"><input id="si-oncall" type="checkbox" /> Available On-Call / Emergency</label>
                <button class="btn" style="background:#6C63FF; color:white;" data-nav="sitter" data-step="5">Next →</button>
            </div>
        </div>

            <div class="phone-mockup">
                <div class="screen">
                    <div class="screen-title">Parent Dashboard</div>
                    <div class="dashboard">
                        <div class="dashboard-header">
                            <div class="greeting">Hi, Sarah! 👋</div>
                            <div class="notification-icon">
                                <i class="fas fa-bell"></i>
                            </div>
                        </div>

                        <div class="booking-card">
                            <h3 style="margin-bottom: 10px;">Upcoming Booking</h3>
                            <p>📅 Today, 7:00 PM - 11:00 PM</p>
                            <p>👩‍🦰 Emma Johnson</p>
                            <p>📍 Your Home</p>
                        </div>

                        <div class="quick-actions">
                            <button class="action-btn">
                                <div class="action-icon">🔍</div>
                                <div>Find Sitter</div>
                            </button>
                            <button class="action-btn">
                                <div class="action-icon">📅</div>
                                <div>My Bookings</div>
                            </button>
                            <button class="action-btn">
                                <div class="action-icon">⭐</div>
                                <div>Favorites</div>

        <!-- Sitter Step 1: Basic Info (3 questions) -->
        <div class="screen hidden" id="sitter-step-1">
            <button class="back-btn" data-action="back" aria-label="Go back"><i class="fas fa-arrow-left"></i></button>
            <div style="padding:24px; background:#FAFAFA; min-height:100%; display:flex; flex-direction:column; gap:12px;">
                <div class="progress-wrap">
                    <div class="progress-bar"><div class="progress-fill" style="width:8.3%"></div></div>
                    <div class="progress-label">Step 1/12</div>
                </div>
                <h2 style="text-align:center; color:#2C3E50;">Basic Info</h2>
                <input id="si-fullname" class="form-input" placeholder="Full Name *" />
                <input id="si-dob" class="form-input" type="date" placeholder="Date of Birth *" />
                <input id="si-phone" class="form-input" placeholder="Phone *" />
                <button class="btn" style="background:#6C63FF; color:white;" data-nav="sitter" data-step="2">Next →</button>
            </div>
        </div>

        <!-- Sitter Step 2: Contact & Privacy (3 questions) -->
        <div class="screen hidden" id="sitter-step-2">
            <button class="back-btn" data-action="back" aria-label="Go back"><i class="fas fa-arrow-left"></i></button>
            <div style="padding:24px; background:#FAFAFA; min-height:100%; display:flex; flex-direction:column; gap:12px;">
                <div class="progress-wrap">
                    <div class="progress-bar"><div class="progress-fill" style="width:16.6%"></div></div>
                    <div class="progress-label">Step 2/12</div>
                </div>
                <h2 style="text-align:center; color:#2C3E50;">Contact & Privacy</h2>
                <input id="si-email" class="form-input" placeholder="Email *" />
                <input id="si-nickname" class="form-input" placeholder="Preferred Name/Nickname *" />
                <label style="display:flex; align-items:center; gap:8px; color:#2C3E50;"><input id="si-privacy" type="checkbox" /> Show only my first name until booked *</label>
                <button class="btn" style="background:#6C63FF; color:white;" data-nav="sitter" data-step="3">Next →</button>
            </div>
        </div>

        <!-- Sitter Step 3: Identity Verification (3 tasks) -->
        <div class="screen hidden" id="sitter-step-3">
            <button class="back-btn" data-action="back" aria-label="Go back"><i class="fas fa-arrow-left"></i></button>
            <div style="padding:24px; background:#FAFAFA; min-height:100%; display:flex; flex-direction:column; gap:12px;">
                <div class="progress-wrap">
                    <div class="progress-bar"><div class="progress-fill" style="width:24.9%"></div></div>
                    <div class="progress-label">Step 3/12</div>
                </div>
                <h2 style="text-align:center; color:#2C3E50;">Identity Verification</h2>
                <button class="btn" style="background:white; border:2px dashed #E8E8E8; color:#2C3E50;">Upload Profile Photo *</button>
                <button class="btn" style="background:white; border:2px dashed #E8E8E8; color:#2C3E50;">Upload ID *</button>
                <label style="display:flex; align-items:center; gap:8px; color:#2C3E50;"><input id="si-consent" type="checkbox" /> I agree to background checks *</label>
                <button class="btn" style="background:#6C63FF; color:white;" data-nav="sitter" data-step="4">Next →</button>
            </div>
        </div>

        <!-- Sitter Step 4: Experience & Skills (3 questions) -->
        <div class="screen hidden" id="sitter-step-4">
            <button class="back-btn" data-action="back" aria-label="Go back"><i class="fas fa-arrow-left"></i></button>
            <div style="padding:24px; background:#FAFAFA; min-height:100%; display:flex; flex-direction:column; gap:12px;">
                <div class="progress-wrap">
                    <div class="progress-bar"><div class="progress-fill" style="width:33.2%"></div></div>
                    <div class="progress-label">Step 4/12</div>
                </div>
                <select id="si-years" class="form-input">
                    <option value="0">No experience yet</option>
                    <option value="1">1 year</option>
                    <option value="2">2 years</option>
                    <option value="3">3 years</option>
                    <option value="4">4+ years</option>
                </select>
                <div style="display:grid; grid-template-columns:repeat(2, 1fr); gap:8px; color:#2C3E50;">
                    <label><input type="checkbox" class="si-skill" value="infants" /> Infants *</label>
                    <label><input type="checkbox" class="si-skill" value="toddlers" /> Toddlers *</label>
                    <label><input type="checkbox" class="si-skill" value="preschoolers" /> Preschoolers *</label>
                </div>
                <input id="si-languages" class="form-input" placeholder="Languages *" />
                <button class="btn" style="background:#6C63FF; color:white;" data-nav="sitter" data-step="5">Next →</button>
            </div>
        </div>

        <!-- Sitter Step 5: Availability (3 items) -->
        <div class="screen hidden" id="sitter-step-5">
            <button class="back-btn" data-action="back" aria-label="Go back"><i class="fas fa-arrow-left"></i></button>
            <div style="padding:24px; background:#FAFAFA; min-height:100%; display:flex; flex-direction:column; gap:12px;">
                <div class="progress-wrap">
                    <div class="progress-bar"><div class="progress-fill" style="width:41.5%"></div></div>
                    <div class="progress-label">Step 5/12</div>
                </div>
                <div style="display:grid; grid-template-columns:repeat(7,1fr); gap:6px;">
                    <label style="text-align:center;"><input type="checkbox" class="ai-day" value="Sun" /> S *</label>
                    <label style="text-align:center;"><input type="checkbox" class="ai-day" value="Mon" /> M *</label>
                    <label style="text-align:center;"><input type="checkbox" class="ai-day" value="Tue" /> T *</label>
                    <label style="text-align:center;"><input type="checkbox" class="ai-day" value="Wed" /> W *</label>
                    <label style="text-align:center;"><input type="checkbox" class="ai-day" value="Thu" /> T *</label>
                    <label style="text-align:center;"><input type="checkbox" class="ai-day" value="Fri" /> F *</label>
                    <label style="text-align:center;"><input type="checkbox" class="ai-day" value="Sat" /> S *</label>
                </div>
                <label style="display:flex; align-items:center; gap:8px; color:#2C3E50;"><input id="si-overnight" type="checkbox" /> Overnight care *</label>
                <label style="display:flex; align-items:center; gap:8px; color:#2C3E50;"><input id="si-oncall" type="checkbox" /> On-call / Emergency *</label>
                <button class="btn" style="background:#6C63FF; color:white;" data-nav="sitter" data-step="6">Next →</button>
            </div>
        </div>

        <!-- Sitter Step 6: Household Support (3 items) -->
        <div class="screen hidden" id="sitter-step-6">
            <button class="back-btn" data-action="back" aria-label="Go back"><i class="fas fa-arrow-left"></i></button>
            <div style="padding:24px; background:#FAFAFA; min-height:100%; display:flex; flex-direction:column; gap:12px;">
                <div class="progress-wrap">
                    <div class="progress-bar"><div class="progress-fill" style="width:49.8%"></div></div>
                    <div class="progress-label">Step 6/12</div>
                </div>
                <label><input type="checkbox" class="ai-house" value="cooking" /> Light cooking *</label>
                <label><input type="checkbox" class="ai-house" value="homework" /> Homework help *</label>
                <label><input type="checkbox" class="ai-house" value="housework" /> Light housework *</label>
                <button class="btn" style="background:#6C63FF; color:white;" data-nav="sitter" data-step="7">Next →</button>
            </div>
        </div>

        <!-- Sitter Step 7: Safety & Emergency (3 items) -->
        <div class="screen hidden" id="sitter-step-7">
            <button class="back-btn" data-action="back" aria-label="Go back"><i class="fas fa-arrow-left"></i></button>
            <div style="padding:24px; background:#FAFAFA; min-height:100%; display:flex; flex-direction:column; gap:12px;">
                <div class="progress-wrap">
                    <div class="progress-bar"><div class="progress-fill" style="width:58.1%"></div></div>
                    <div class="progress-label">Step 7/12</div>
                </div>
                <div style="display:flex; gap:10px; color:#2C3E50;">
                    <label><input type="radio" name="ai-cpr" value="yes" /> CPR/First Aid: Yes *</label>
                    <label><input type="radio" name="ai-cpr" value="no" /> No *</label>
                </div>
                <textarea id="si-emergency" class="form-input" placeholder="How would you handle a medical emergency? *" style="min-height:70px;"></textarea>
                <div style="display:flex; gap:10px; color:#2C3E50;">
                    <label><input type="radio" name="ai-managed-emergency" value="yes" /> Managed an emergency before *</label>
                    <label><input type="radio" name="ai-managed-emergency" value="no" /> Not yet *</label>
                </div>
                <button class="btn" style="background:#6C63FF; color:white;" data-nav="sitter" data-step="8">Next →</button>
            </div>
        </div>

        <!-- Sitter Step 8: Rates & Payments (3 items) -->
        <div class="screen hidden" id="sitter-step-8">
            <button class="back-btn" data-action="back" aria-label="Go back"><i class="fas fa-arrow-left"></i></button>
            <div style="padding:24px; background:#FAFAFA; min-height:100%; display:flex; flex-direction:column; gap:12px;">
                <div class="progress-wrap">
                    <div class="progress-bar"><div class="progress-fill" style="width:66.4%"></div></div>
                    <div class="progress-label">Step 8/12</div>
                </div>
                <input id="si-rate" type="number" class="form-input" placeholder="Hourly rate ($) *" />
                <label><input id="si-weekend" type="checkbox" /> Weekend/Holiday rates *</label>
                <label><input id="si-instant" type="checkbox" /> Accept Instant Payments *</label>
                <button class="btn" style="background:#6C63FF; color:white;" data-nav="sitter" data-step="9">Next →</button>
            </div>
        </div>

        <!-- Sitter Step 9: Background & References (3 items) -->
        <div class="screen hidden" id="sitter-step-9">
            <button class="back-btn" data-action="back" aria-label="Go back"><i class="fas fa-arrow-left"></i></button>
            <div style="padding:24px; background:#FAFAFA; min-height:100%; display:flex; flex-direction:column; gap:12px;">
                <div class="progress-wrap">
                    <div class="progress-bar"><div class="progress-fill" style="width:74.7%"></div></div>
                    <div class="progress-label">Step 9/12</div>
                </div>
                <div style="display:flex; gap:10px; color:#2C3E50;">
                    <label><input type="radio" name="ai-crime" value="no" /> No convictions *</label>
                    <label><input type="radio" name="ai-crime" value="yes" /> Yes *</label>
                </div>
                <input id="si-ref1" class="form-input" placeholder="Reference 1 (name & contact) *" />
                <input id="si-ref2" class="form-input" placeholder="Reference 2 (name & contact) *" />
                <button class="btn" style="background:#6C63FF; color:white;" data-nav="sitter" data-step="10">Next →</button>
            </div>
        </div>

        <!-- Sitter Step 10: Personal Bio (3 items) -->
        <div class="screen hidden" id="sitter-step-10">
            <button class="back-btn" data-action="back" aria-label="Go back"><i class="fas fa-arrow-left"></i></button>
            <div style="padding:24px; background:#FAFAFA; min-height:100%; display:flex; flex-direction:column; gap:12px;">
                <div class="progress-wrap">
                    <div class="progress-bar"><div class="progress-fill" style="width:83%"></div></div>
                    <div class="progress-label">Step 10/12</div>
                </div>
                <textarea id="si-bio" class="form-input" placeholder="Write a short intro *" style="min-height:80px;"></textarea>
                <input id="si-enjoy" class="form-input" placeholder="What do you enjoy with kids? *" />
                <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:8px; color:#2C3E50;">
                    <label><input type="checkbox" class="ai-hobby" value="arts" /> Arts *</label>
                    <label><input type="checkbox" class="ai-hobby" value="music" /> Music *</label>
                    <label><input type="checkbox" class="ai-hobby" value="sports" /> Sports *</label>
                </div>
                <button class="btn" style="background:#6C63FF; color:white;" data-nav="sitter" data-step="11">Next →</button>
            </div>
        </div>

        <!-- Sitter Step 11: Agreement (3 items) -->
        <div class="screen hidden" id="sitter-step-11">
            <button class="back-btn" data-action="back" aria-label="Go back"><i class="fas fa-arrow-left"></i></button>
            <div style="padding:24px; background:#FAFAFA; min-height:100%; display:flex; flex-direction:column; gap:12px;">
                <div class="progress-wrap">
                    <div class="progress-bar"><div class="progress-fill" style="width:91.3%"></div></div>
                    <div class="progress-label">Step 11/12</div>
                </div>
                <label><input id="si-terms" type="checkbox" /> I accept Terms & Privacy Policy *</label>
                <label><input id="si-safety" type="checkbox" /> I agree to safety guidelines *</label>
                <input id="si-signature" class="form-input" placeholder="Type your full name (signature) *" />
                <button class="btn" style="background:#6C63FF; color:white;" data-nav="sitter" data-step="12">Next →</button>
            </div>
        </div>

        <!-- Sitter Step 12: Success -->
        <div class="screen hidden" id="sitter-step-12">
            <button class="back-btn" data-action="back" aria-label="Go back"><i class="fas fa-arrow-left"></i></button>
            <div style="padding:24px; background:#FAFAFA; min-height:100%; display:flex; flex-direction:column; gap:12px; text-align:center;">
                <div class="progress-wrap">
                    <div class="progress-bar"><div class="progress-fill" style="width:100%"></div></div>
                    <div class="progress-label">Step 12/12</div>
                </div>
                <div style="font-size:1.5rem; font-weight:800; color:#2C3E50;">You’re all set! 🎉</div>
                <div style="color:#7F8C8D;">Your profile is under review. Once verified, parents will see you in search results.</div>
                <button class="btn" style="background:#6C63FF; color:white;" onclick="finishSitterOnboarding()">Go to Dashboard</button>
            </div>
        </div>
                            </button>
                            <button class="action-btn">
                                <div class="action-icon">💬</div>
                                <div>Messages</div>
                            </button>
                        </div>

                        <div style="background: #F8F9FA; border-radius: 16px; padding: 20px;">
                            <h4 style="margin-bottom: 15px; color: #2C3E50;">Recent Activity</h4>
                            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                <div style="width: 40px; height: 40px; background: #87CEEB; border-radius: 50%; margin-right: 15px;"></div>
                                <div>
                                    <div style="font-weight: 600;">Booking Completed</div>
                                    <div style="font-size: 0.9rem; color: #7F8C8D;">with Emma Johnson</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Booking Page -->
            <div class="phone-mockup">
                <div class="screen">
                    <div class="screen-title">Book a Sitter</div>
                    <div style="padding: 20px;">
                        <div style="margin-bottom: 25px;">
                            <h4 style="margin-bottom: 15px; color: #2C3E50;">📅 Select Date & Time</h4>
                            <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin-bottom: 15px;">
                                <div style="text-align: center; padding: 10px; background: #F8F9FA; border-radius: 8px; font-size: 0.8rem;">S</div>
                                <div style="text-align: center; padding: 10px; background: #F8F9FA; border-radius: 8px; font-size: 0.8rem;">M</div>
                                <div style="text-align: center; padding: 10px; background: #FF69B4; color: white; border-radius: 8px; font-size: 0.8rem;">T</div>
                                <div style="text-align: center; padding: 10px; background: #F8F9FA; border-radius: 8px; font-size: 0.8rem;">W</div>
                                <div style="text-align: center; padding: 10px; background: #F8F9FA; border-radius: 8px; font-size: 0.8rem;">T</div>
                                <div style="text-align: center; padding: 10px; background: #F8F9FA; border-radius: 8px; font-size: 0.8rem;">F</div>
                                <div style="text-align: center; padding: 10px; background: #F8F9FA; border-radius: 8px; font-size: 0.8rem;">S</div>
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button style="flex: 1; padding: 12px; background: #87CEEB; color: white; border: none; border-radius: 12px;">7:00 PM</button>
                                <button style="flex: 1; padding: 12px; background: #F8F9FA; border: none; border-radius: 12px;">8:00 PM</button>
                                <button style="flex: 1; padding: 12px; background: #F8F9FA; border: none; border-radius: 12px;">9:00 PM</button>
                            </div>
                        </div>

                        <div style="margin-bottom: 25px;">
                            <h4 style="margin-bottom: 15px; color: #2C3E50;">📍 Location</h4>
                            <div style="background: #F8F9FA; border-radius: 12px; padding: 15px; display: flex; align-items: center;">
                                <i class="fas fa-map-marker-alt" style="color: #FF69B4; margin-right: 10px;"></i>
                                <span>123 Main St, Your City</span>
                            </div>
                        </div>

                        <div style="margin-bottom: 25px;">
                            <h4 style="margin-bottom: 15px; color: #2C3E50;">👩‍🦰 Available Sitters</h4>
                            <div style="background: white; border-radius: 16px; padding: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 15px;">
                                <div style="display: flex; align-items: center;">
                                    <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #FF69B4, #87CEEB); border-radius: 50%; margin-right: 15px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem;">E</div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; margin-bottom: 5px;">Emma Johnson</div>
                                        <div style="display: flex; align-items: center; margin-bottom: 5px;">
                                            <span style="color: #F39C12;">⭐⭐⭐⭐⭐</span>
                                            <span style="margin-left: 8px; font-size: 0.9rem; color: #7F8C8D;">4.9 (127)</span>
                                        </div>
                                        <div style="color: #FF69B4; font-weight: 600;">$25/hour</div>
                                    </div>
                                    <div style="background: #FF69B4; color: white; padding: 8px 16px; border-radius: 20px; font-size: 0.9rem;">Select</div>
                                </div>
                            </div>
                        </div>

                        <button style="display: block; position: static; width: calc(100% - 40px); margin: 20px auto 10px; background: #FF69B4; color: white; border: none; padding: 18px; border-radius: 25px; font-size: 1.1rem; font-weight: 600;">
                            Book Now - $100
                        </button>
                    </div>
                </div>
            </div>

            <!-- Sitter Profile -->
            <div class="phone-mockup">
                <div class="screen">
                    <div style="position: relative;">
                        <div style="height: 200px; background: linear-gradient(135deg, #FF69B4, #87CEEB); display: flex; align-items: center; justify-content: center;">
                            <div style="width: 120px; height: 120px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 3rem; color: #FF69B4;">👩‍🦰</div>
                        </div>
                        <div style="position: absolute; top: 20px; right: 20px; background: #2ECC71; color: white; padding: 8px 12px; border-radius: 20px; font-size: 0.8rem;">
                            ✓ Verified
                        </div>
                    </div>

                    <div style="padding: 20px;">
                        <div style="text-align: center; margin-bottom: 25px;">
                            <h2 style="margin-bottom: 5px;">Emma Johnson</h2>
                            <div style="color: #7F8C8D; margin-bottom: 10px;">📍 2.3 miles away</div>
                            <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 10px;">
                                <span style="color: #F39C12;">⭐⭐⭐⭐⭐</span>
                                <span style="margin-left: 8px; color: #7F8C8D;">4.9 (127 reviews)</span>
                            </div>
                            <div style="color: #FF69B4; font-size: 1.5rem; font-weight: 700;">$25/hour</div>
                        </div>

                        <div style="margin-bottom: 25px;">
                            <h4 style="margin-bottom: 15px;">About Me</h4>
                            <p style="color: #7F8C8D; line-height: 1.5;">Experienced childcare provider with 5+ years caring for children ages 6 months to 12 years. CPR certified and background checked.</p>
                        </div>

                        <div style="margin-bottom: 25px;">
                            <h4 style="margin-bottom: 15px;">Skills & Certifications</h4>
                            <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                <span style="background: #FFB6C1; color: #C71585; padding: 6px 12px; border-radius: 20px; font-size: 0.8rem;">CPR Certified</span>
                                <span style="background: #B0E0E6; color: #4682B4; padding: 6px 12px; border-radius: 20px; font-size: 0.8rem;">First Aid</span>
                                <span style="background: #FFB6C1; color: #C71585; padding: 6px 12px; border-radius: 20px; font-size: 0.8rem;">Newborn Care</span>
                                <span style="background: #B0E0E6; color: #4682B4; padding: 6px 12px; border-radius: 20px; font-size: 0.8rem;">Homework Help</span>
                            </div>
                        </div>

                        <div style="display: flex; gap: 15px; margin-top: 30px;">
                            <button style="flex: 1; background: #87CEEB; color: white; border: none; padding: 15px; border-radius: 25px; font-weight: 600;">
                                💬 Message
                            </button>
                            <button style="flex: 1; background: #FF69B4; color: white; border: none; padding: 15px; border-radius: 25px; font-weight: 600;">
                                📅 Book Now
                            </button>

            <!-- Parent Onboarding: Step 0 Welcome -->
            <div class="screen hidden" id="parent-screen-0">
                <button class="back-btn" data-action="back" aria-label="Go back"><i class="fas fa-arrow-left"></i></button>
                <div class="parent-wizard" style="padding:24px; background:#FAFAFA; min-height:100%; display:flex; flex-direction:column; gap:14px;">
                    <div class="progress-wrap">
                        <div class="progress-bar"><div class="progress-fill" style="width:0%"></div></div>
                        <div class="progress-label">Step 0/9</div>
                    </div>
                    <div style="text-align:center;">
                        <div style="font-size:1.6rem; font-weight:800; color:#2C3E50;">Welcome to NannyRadar, Parent! 👋</div>
                        <div style="color:#7F8C8D;">Let’s set up your profile so you can find the perfect sitter.</div>
                    </div>
                    <button class="btn" style="background:#6C63FF; color:white;" data-nav="parent" data-step="1">Get Started</button>
                </div>
            </div>

            <!-- Parent Step 1: Basic Info -->
            <div class="screen hidden" id="parent-step-1">
                <button class="back-btn" data-action="back" aria-label="Go back"><i class="fas fa-arrow-left"></i></button>
                <div class="parent-wizard" style="padding:24px; background:#FAFAFA; min-height:100%; display:flex; flex-direction:column; gap:12px;">
                    <div class="progress-wrap">
                        <div class="progress-bar"><div class="progress-fill" style="width:11.1%"></div></div>
                        <div class="progress-label">Step 1/9</div>
                    </div>
                    <input id="pa-fullname" class="form-input" placeholder="Full Name *" />
                    <input id="pa-phone" class="form-input" placeholder="Phone Number *" />
                    <input id="pa-email" class="form-input" placeholder="Email Address *" />
                    <button class="btn" style="background:#6C63FF; color:white;" data-nav="parent" data-step="2">Next →</button>
                </div>
            </div>

            <!-- Parent Step 2: Address -->
            <div class="screen hidden" id="parent-step-2">
                <button class="back-btn" data-action="back" aria-label="Go back"><i class="fas fa-arrow-left"></i></button>
                <div class="parent-wizard" style="padding:24px; background:#FAFAFA; min-height:100%; display:flex; flex-direction:column; gap:12px;">
                    <div class="progress-wrap">
                        <div class="progress-bar"><div class="progress-fill" style="width:22.2%"></div></div>
                        <div class="progress-label">Step 2/9</div>
                    </div>
                    <input id="pa-city" class="form-input" placeholder="City *" />
                    <input id="pa-zip" class="form-input" placeholder="Zip Code *" />
                    <input id="pa-address2" class="form-input" placeholder="Apt/Suite (optional)" />
                    <button class="btn" style="background:#6C63FF; color:white;" data-nav="parent" data-step="3">Next →</button>
                </div>
            </div>

            <!-- Parent Step 3: Family Profile -->
            <div class="screen hidden" id="parent-step-3">
                <button class="back-btn" data-action="back" aria-label="Go back"><i class="fas fa-arrow-left"></i></button>
                <div class="parent-wizard" style="padding:24px; background:#FAFAFA; min-height:100%; display:flex; flex-direction:column; gap:12px;">
                    <div class="progress-wrap">
                        <div class="progress-bar"><div class="progress-fill" style="width:33.3%"></div></div>
                        <div class="progress-label">Step 3/9</div>
                    </div>
                    <input id="pa-children" class="form-input" placeholder="Number of Children *" />
                    <input id="pa-ages" class="form-input" placeholder="Ages (e.g., 2, 6) *" />
                    <input id="pa-allergies" class="form-input" placeholder="Special Needs/Allergies (optional)" />
                    <button class="btn" style="background:#6C63FF; color:white;" data-nav="parent" data-step="4">Next →</button>
                </div>
            </div>

            <!-- Parent Step 4: Pets -->
            <div class="screen hidden" id="parent-step-4">
                <button class="back-btn" data-action="back" aria-label="Go back"><i class="fas fa-arrow-left"></i></button>
                <div class="parent-wizard" style="padding:24px; background:#FAFAFA; min-height:100%; display:flex; flex-direction:column; gap:12px;">
                    <div class="progress-wrap"><div class="progress-bar"><div class="progress-fill" style="width:44.4%"></div></div><div class="progress-label">Step 4/9</div></div>
                    <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:8px;">
                        <label><input type="checkbox" class="pa-pet" value="dog" /> Dog *</label>
                        <label><input type="checkbox" class="pa-pet" value="cat" /> Cat *</label>
                        <label><input type="checkbox" class="pa-pet" value="other" /> Other *</label>
                    </div>
                    <button class="btn" style="background:#6C63FF; color:white;" data-nav="parent" data-step="5">Next →</button>
                </div>
            </div>

            <!-- Parent Step 5: Booking Preferences -->
            <div class="screen hidden" id="parent-step-5">
                <button class="back-btn" data-action="back" aria-label="Go back"><i class="fas fa-arrow-left"></i></button>
                <div class="parent-wizard" style="padding:24px; background:#FAFAFA; min-height:100%; display:flex; flex-direction:column; gap:12px;">
                    <div class="progress-wrap"><div class="progress-bar"><div class="progress-fill" style="width:55.5%"></div></div><div class="progress-label">Step 5/9</div></div>
                    <div style="display:grid; grid-template-columns:1fr; gap:6px;">
                        <label><input type="checkbox" class="pa-book" value="one-time" /> One-time/date-night *</label>
                        <label><input type="checkbox" class="pa-book" value="recurring" /> Recurring/weekly *</label>
                        <label><input type="checkbox" class="pa-book" value="full-time" /> Full-time nanny *</label>
                    </div>
                    <input id="pa-hours" class="form-input" placeholder="Typical hours (e.g., evenings) *" />
                    <label><input id="pa-oncall" type="checkbox" /> Allow on-call/emergency sitters *</label>
                    <button class="btn" style="background:#6C63FF; color:white;" data-nav="parent" data-step="6">Next →</button>
                </div>
            </div>

            <!-- Parent Step 6: Safety & Verification -->
            <div class="screen hidden" id="parent-step-6">
                <button class="back-btn" data-action="back" aria-label="Go back"><i class="fas fa-arrow-left"></i></button>
                <div class="parent-wizard" style="padding:24px; background:#FAFAFA; min-height:100%; display:flex; flex-direction:column; gap:12px;">
                    <div class="progress-wrap"><div class="progress-bar"><div class="progress-fill" style="width:66.6%"></div></div><div class="progress-label">Step 6/9</div></div>
                    <button class="btn" style="background:white; border:2px dashed #E8E8E8; color:#2C3E50;">Upload ID *</button>
                    <input id="pa-emerg-name" class="form-input" placeholder="Emergency Contact Name *" />
                    <input id="pa-emerg-phone" class="form-input" placeholder="Emergency Contact Phone *" />
                    <button class="btn" style="background:#6C63FF; color:white;" data-nav="parent" data-step="7">Next →</button>
                </div>
            </div>

            <!-- Parent Step 7: Payment Setup -->
            <div class="screen hidden" id="parent-step-7">
                <button class="back-btn" data-action="back" aria-label="Go back"><i class="fas fa-arrow-left"></i></button>
                <div class="parent-wizard" style="padding:24px; background:#FAFAFA; min-height:100%; display:flex; flex-direction:column; gap:12px;">
                    <div class="progress-wrap"><div class="progress-bar"><div class="progress-fill" style="width:77.7%"></div></div><div class="progress-label">Step 7/9</div></div>
                    <div style="display:grid; grid-template-columns:1fr; gap:6px;">
                        <label><input type="radio" name="pa-pay" value="card" /> Credit/Debit Card *</label>
                        <label><input type="radio" name="pa-pay" value="stripe" /> Stripe *</label>
                        <label><input type="radio" name="pa-pay" value="cashapp" /> Cash App *</label>
                    </div>
                    <label><input id="pa-autopay" type="checkbox" /> Automatic payments *</label>
                    <label><input id="pa-credits" type="checkbox" /> Pre-load credits *</label>
                    <button class="btn" style="background:#6C63FF; color:white;" data-nav="parent" data-step="8">Next →</button>
                </div>
            </div>

            <!-- Parent Step 8: Trust & Reviews -->
            <div class="screen hidden" id="parent-step-8">
                <button class="back-btn" data-action="back" aria-label="Go back"><i class="fas fa-arrow-left"></i></button>
                <div class="parent-wizard" style="padding:24px; background:#FAFAFA; min-height:100%; display:flex; flex-direction:column; gap:12px;">
                    <div class="progress-wrap"><div class="progress-bar"><div class="progress-fill" style="width:88.8%"></div></div><div class="progress-label">Step 8/9</div></div>
                    <label><input id="pa-consent-review" type="checkbox" /> Consent to leave sitter reviews *</label>
                    <label><input id="pa-consent-share" type="checkbox" /> Consent to share feedback with sitters *</label>
                    <label><input id="pa-show-other" type="checkbox" /> Allow viewing reviews left by other parents *</label>
                    <button class="btn" style="background:#6C63FF; color:white;" data-nav="parent" data-step="9">Next →</button>
                </div>
            </div>

            <!-- Parent Step 9: Final Agreement & Success -->
            <div class="screen hidden" id="parent-step-9">
                <button class="back-btn" data-action="back" aria-label="Go back"><i class="fas fa-arrow-left"></i></button>
                <div class="parent-wizard" style="padding:24px; background:#FAFAFA; min-height:100%; display:flex; flex-direction:column; gap:12px; text-align:center;">
                    <div class="progress-wrap"><div class="progress-bar"><div class="progress-fill" style="width:100%"></div></div><div class="progress-label">Step 9/9</div></div>
                    <label style="text-align:left;"><input id="pa-terms" type="checkbox" /> I accept Terms & Privacy Policy *</label>
                    <label style="text-align:left;"><input id="pa-safety" type="checkbox" /> I acknowledge Safety Guidelines *</label>
                    <label style="text-align:left;"><input id="pa-disclaimer" type="checkbox" /> I understand NannyRadar connects families and sitters, not a legal employer *</label>
                    <input id="pa-signature" class="form-input" placeholder="Type your full name (signature) *" />
                    <button class="btn" style="background:#6C63FF; color:white;" onclick="finishParentOnboarding()">Complete & Go to Dashboard</button>
                </div>
            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Payment Screen -->
            <div class="phone-mockup">
                <div class="screen">
                    <div class="screen-title">Payment</div>
                    <div style="padding: 20px;">
                        <div style="background: #F8F9FA; border-radius: 16px; padding: 20px; margin-bottom: 25px;">
                            <h4 style="margin-bottom: 15px; color: #2C3E50;">Booking Summary</h4>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>Sitter: Emma Johnson</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>Date: Today, 7:00 PM - 11:00 PM</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>Duration: 4 hours</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 15px; padding-top: 15px; border-top: 1px solid #E8E8E8;">
                                <span style="font-weight: 600;">Total:</span>
                                <span style="font-weight: 700; color: #FF69B4; font-size: 1.2rem;">$100.00</span>
                            </div>
                        </div>

                        <div style="margin-bottom: 25px;">
                            <h4 style="margin-bottom: 15px; color: #2C3E50;">Payment Method</h4>
                            <div style="background: white; border: 2px solid #FF69B4; border-radius: 12px; padding: 15px; margin-bottom: 10px; display: flex; align-items: center;">
                                <i class="fab fa-cc-stripe" style="font-size: 1.5rem; color: #6772E5; margin-right: 15px;"></i>
                                <div>
                                    <div style="font-weight: 600;">•••• •••• •••• 4242</div>
                                    <div style="font-size: 0.9rem; color: #7F8C8D;">Expires 12/25</div>
                                </div>
                                <i class="fas fa-check-circle" style="color: #FF69B4; margin-left: auto;"></i>
                            </div>
                            <div style="background: #F8F9FA; border-radius: 12px; padding: 15px; display: flex; align-items: center;">
                                <i class="fab fa-paypal" style="font-size: 1.5rem; color: #0070BA; margin-right: 15px;"></i>
                                <span>PayPal</span>
                            </div>
                        </div>

                        <div style="margin-bottom: 25px;">
                            <h4 style="margin-bottom: 15px; color: #2C3E50;">Promo Code</h4>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" placeholder="Enter promo code" style="flex: 1; padding: 15px; border: 2px solid #E8E8E8; border-radius: 12px;">
                                <button style="background: #87CEEB; color: white; border: none; padding: 15px 20px; border-radius: 12px;">Apply</button>
                            </div>
                        </div>

                        <button style="width: 100%; background: #FF69B4; color: white; border: none; padding: 18px; border-radius: 25px; font-size: 1.1rem; font-weight: 600; margin-top: 20px;">
                            Confirm Payment - $100.00
                        </button>

                        <p style="text-align: center; margin-top: 15px; font-size: 0.9rem; color: #7F8C8D;">
                            🔒 Your payment is secure and encrypted
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Design Features Section (hidden during onboarding) -->
        <div data-section="design-features" style="background: white; border-radius: 20px; padding: 30px; margin-top: 40px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
            <h2 style="text-align: center; margin-bottom: 30px; color: #2C3E50;">🎨 Design Features</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 2rem; margin-bottom: 10px;">🎨</div>
                    <h4 style="margin-bottom: 10px; color: #FF69B4;">Color Palette</h4>
                    <p style="color: #7F8C8D;">Pink (#FF69B4), Blue (#87CEEB), and White with subtle gradients</p>
                </div>
                <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 2rem; margin-bottom: 10px;">📱</div>
                    <h4 style="margin-bottom: 10px; color: #87CEEB;">Mobile-First</h4>
                    <p style="color: #7F8C8D;">Optimized for iOS and Android with responsive design</p>
                </div>
                <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 2rem; margin-bottom: 10px;">✨</div>
                    <h4 style="margin-bottom: 10px; color: #FF69B4;">Animations</h4>
                    <p style="color: #7F8C8D;">Smooth transitions and hover effects for better UX</p>
                </div>

                <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 2rem; margin-bottom: 10px;">🔤</div>
                    <h4 style="margin-bottom: 10px; color: #87CEEB;">Typography</h4>
                    <p style="color: #7F8C8D;">Nunito & Poppins fonts for friendly, professional feel</p>
                </div>
            </div>

        </div>

        <!-- Screen 3: Parent Dashboard -->

        <div class="screen hidden" id="screen-2">
            <button class="back-btn" onclick="prevScreen()" aria-label="Go back"><i class="fas fa-arrow-left"></i></button>

                <button class="btn" style="width:auto; padding:10px 14px; background:#EEE; color:#333;" onclick="showScreen(6)">Settings</button>

            <div id="parent-dashboard" style="padding: 30px; background: #FAFAFA;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; padding-top: 20px;">
                    <div>
                        <h2 style="font-size: 1.8rem; margin-bottom: 5px;">Hi, Sarah! 👋</h2>
                        <p style="color: #7F8C8D;">Welcome back</p>
                    </div>
                    <div style="width: 50px; height: 50px; background: #FF69B4; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2rem;">
                        <i class="fas fa-bell"></i>
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, #FF69B4, #87CEEB); border-radius: 20px; padding: 25px; color: white; margin-bottom: 40px;">
                    <h3 style="margin-bottom: 15px; font-size: 1.3rem;">Upcoming Booking</h3>
                    <p style="margin-bottom: 8px; font-size: 1.1rem;">📅 Today, 7:00 PM - 11:00 PM</p>
                    <p style="margin-bottom: 8px; font-size: 1.1rem;">👩‍🦰 Emma Johnson</p>
                    <p style="font-size: 1.1rem;">📍 Your Home</p>
                </div>
                    <div id="checkin-status-badge" style="margin-top:10px; display:inline-block; padding:6px 10px; border-radius:999px; background:#27AE60; color:#fff; font-weight:600; font-size:0.85rem;">Status: On Track</div>
                        <span id="checkin-countdown" style="margin-left:10px; color:#2C3E50; font-weight:600; font-size:0.85rem;">Next check-in: —</span>
                        <div id="trusted-share-row" style="display:flex; align-items:center; gap:10px; margin:10px 0 16px 0;">
                            <label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
                                <input id="trusted-share-toggle" type="checkbox" onchange="NR_Trusted.onShareToggle(this.checked)" />
                                <span style="color:#2C3E50; font-weight:600;">Share this session with Trusted Circle</span>
                            </label>
                            <span id="trusted-shared-count" style="color:#7F8C8D; font-size:0.9rem;">Shared with 0</span>
                        </div>
                        <div id="geo-row" style="display:flex; align-items:center; gap:10px; margin:6px 0 10px 0;">
                            <label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
                                <input id="geo-toggle" type="checkbox" onchange="NR_Geo.onGeoToggle(this.checked)" />
                                <span style="color:#2C3E50; font-weight:600;">Enable Geo-Fence</span>
                            </label>
                            <label style="display:flex; align-items:center; gap:6px; color:#2C3E50;">
                                Radius
                                <select id="geo-radius" onchange="NR_Geo.onRadiusChange(this.value)" style="padding:6px 8px; border-radius:10px; border:1px solid #DDD;">
                                    <option value="50">50m</option>
                                    <option value="100" selected>100m</option>
                                    <option value="200">200m</option>
                                    <option value="500">500m</option>
                                </select>
                            </label>
                            <span id="geo-status" style="color:#7F8C8D; font-size:0.9rem;">Location: —</span>
                        </div>
                        <div style="display:flex; align-items:center; gap:10px; margin:6px 0 14px 0;">
                            <button class="btn" style="background:#EEE; color:#333;" onclick="NR_Geo.openCenterModal()">Set Location</button>
                        </div>
                        <div id="trusted-viewers" style="color:#2C3E50; font-size:0.9rem; margin-top:6px;">Shared with: none</div>
                        <button id="btn-end-booking-parent" class="btn" style="margin-left:10px; background:#E74C3C; color:#fff; padding:6px 10px; border-radius:999px; font-size:0.85rem;" onclick="NR_CheckIn.stopSession()" aria-label="End current booking" hidden>End Booking</button>


                <!-- View Session Drawer (compact) -->
                <div id="session-drawer" style="display:none; position:fixed; bottom:0; left:0; right:0; margin:auto; max-width:420px; background:#fff; border-top-left-radius:16px; border-top-right-radius:16px; box-shadow:0 -8px 24px rgba(0,0,0,0.12); padding:14px; z-index:70;">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <strong style="color:#2C3E50;">Session Overview</strong>
                        <button class="btn" style="background:#EEE; color:#333; width:auto; padding:6px 10px;" onclick="NR_SessionDrawer.close()">Close</button>
                    </div>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-top:10px;">
                        <div><div style="color:#7F8C8D; font-size:0.85rem;">Interval</div><div id="sd-interval" style="font-weight:700;">—</div></div>
                        <div><div style="color:#7F8C8D; font-size:0.85rem;">Next Check-In</div><div id="sd-countdown" style="font-weight:700;">—</div></div>
                        <div><div style="color:#7F8C8D; font-size:0.85rem;">Last Check-In</div><div id="sd-last" style="font-weight:700;">—</div></div>
                        <div><div style="color:#7F8C8D; font-size:0.85rem;">Geo-Fence</div><div id="sd-geo" style="font-weight:700;">—</div></div>
                    </div>
                    <div style="margin-top:10px;">
                        <div style="color:#7F8C8D; font-size:0.85rem;">Shared With</div>
                        <div id="sd-shared" style="font-weight:700;">none</div>
                    </div>
                    <div style="margin-top:10px;">
                        <div style="color:#7F8C8D; font-size:0.85rem;">Recent Events</div>
                        <div style="display:flex; gap:6px; align-items:center; margin:6px 0;">
                            <input id="sd-note" class="form-input" placeholder="Add note..." style="flex:1; padding:8px 10px; border-radius:10px; border:1px solid #DDD;">
                            <button class="btn" style="background:#6C63FF; color:#fff;" onclick="NR_SessionDrawer.addNote()">Add</button>
                            <button class="btn" style="background:#EEE; color:#333;" onclick="NR_SessionDrawer.clear()">Clear</button>
                        </div>
                        <div id="sd-events" style="font-size:0.9rem; display:flex; flex-direction:column; gap:4px; max-height:120px; overflow:auto;">
                            <!-- events -->
                        </div>
                    </div>
                </div>

                <div style="display:flex; justify-content:center; margin-bottom:12px;">
                    <button class="btn" style="background:#87CEEB; color:#fff;" onclick="NR_SessionDrawer.toggle()">View Session</button>
                </div>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 40px;">
                    <button style="background: white; border-radius: 20px; padding: 25px; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.1); border: none; cursor: pointer; transition: transform 0.2s;" onclick="findSitter()" ontouchstart="this.style.transform='scale(0.95)'" ontouchend="this.style.transform='scale(1)'">
                        <div style="font-size: 2.5rem; margin-bottom: 10px;">🔍</div>
                        <div style="font-weight: 600; color: #2C3E50;">Find Sitter</div>
                    </button>
                    <button style="background: white; border-radius: 20px; padding: 25px; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.1); border: none; cursor: pointer; transition: transform 0.2s;" onclick="viewBookings()" ontouchstart="this.style.transform='scale(0.95)'" ontouchend="this.style.transform='scale(1)'">
                        <div style="font-size: 2.5rem; margin-bottom: 10px;">📅</div>
                        <div style="font-weight: 600; color: #2C3E50;">My Bookings</div>
                    </button>
                    <button style="background: white; border-radius: 20px; padding: 25px; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.1); border: none; cursor: pointer; transition: transform 0.2s;" onclick="viewFavorites()" ontouchstart="this.style.transform='scale(0.95)'" ontouchend="this.style.transform='scale(1)'">
                        <div style="font-size: 2.5rem; margin-bottom: 10px;">⭐</div>
                        <div style="font-weight: 600; color: #2C3E50;">Favorites</div>
                    </button>
                    <button style="background: white; border-radius: 20px; padding: 25px; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.1); border: none; cursor: pointer; transition: transform 0.2s;" onclick="viewMessages()" ontouchstart="this.style.transform='scale(0.95)'" ontouchend="this.style.transform='scale(1)'">
                        <div style="font-size: 2.5rem; margin-bottom: 10px;">💬</div>
                        <div style="font-weight: 600; color: #2C3E50;">Messages</div>
                    </button>
                </div>

                <div style="background: white; border-radius: 20px; padding: 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                    <h4 style="margin-bottom: 20px; color: #2C3E50; font-size: 1.2rem;">Recent Activity</h4>
                    <div style="display: flex; align-items: center;">
                        <div style="width: 50px; height: 50px; background: #87CEEB; border-radius: 50%; margin-right: 15px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2rem;">E</div>
                        <div>
                            <div style="font-weight: 600; margin-bottom: 5px;">Booking Completed</div>
                            <div style="font-size: 0.9rem; color: #7F8C8D;">with Emma Johnson</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sitter Dashboard -->
            <div id="sitter-dashboard" style="display:none; padding:30px; background:#FAFAFA;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:24px; padding-top:20px;">
                    <div>
                        <h2 style="font-size:1.8rem; margin-bottom:4px;">Hi there! 👋</h2>
                        <p style="color:#7F8C8D;">Ready for your next job?</p>
                    </div>
                    <div style="width:50px; height:50px; background:#87CEEB; border-radius:50%; display:flex; align-items:center; justify-content:center; color:white; font-size:1.2rem;">
                        <i class="fas fa-bell"></i>
                    </div>
                </div>

                <div style="background:linear-gradient(135deg,#87CEEB,#FF69B4); border-radius:20px; padding:22px; color:white; margin-bottom:24px;">
                    <h3 style="margin-bottom:10px; font-size:1.25rem;">Upcoming Job</h3>
                    <p style="margin-bottom:6px; font-size:1.05rem;">📅 Fri, 7:00 PM - 10:00 PM</p>
                    <p style="margin-bottom:6px; font-size:1.05rem;">👨‍👩‍👧 Johnson Family</p>
                    <p style="font-size:1.05rem;">📍 Downtown, NYC</p>

                    <div style="display:flex; gap:12px; margin-bottom:16px;">
                        <button class="btn" style="background:#6C63FF; color:#fff;" onclick="NR_CheckIn.sendCheckIn()">Send Check-In</button>
                        <button class="btn" style="background:#EEE; color:#333;" onclick="NR_CheckIn.toggleSession()" title="Start/Stop demo session">Start/Stop Session</button>
                    </div>

                    <!-- Feature 4: Verify Arrival + Feature 5: Panic Button -->
                    <div style="display:flex; gap:12px; margin-bottom:16px;">
                        <button class="btn" style="background:#FF8A65; color:#fff;" onclick="NR_Verify.captureArrival()" title="Capture arrival photo for verification">📸 Verify Arrival</button>
                        <button class="btn" style="background:#F44336; color:#fff;" onclick="NR_Emergency.triggerPanic()" title="Emergency alert to trusted contacts">🚨 Panic</button>
                    </div>

                    <!-- Features 11-14: Smart Features -->
                    <div style="display:flex; gap:8px; margin-bottom:16px; flex-wrap:wrap;">
                        <button class="btn" style="background:#6C63FF; color:#fff; font-size:0.9em;" onclick="NR_SmartScheduler.showSchedulerModal('sitter-1')" title="AI-suggested booking times">📅 Smart Schedule</button>
                        <button class="btn" style="background:#FF69B4; color:#fff; font-size:0.9em;" onclick="NR_Rebooking.showRebookingModal('parent-1')" title="Predictive rebooking suggestions">🔄 Rebook</button>
                        <button class="btn" style="background:#4CAF50; color:#fff; font-size:0.9em;" onclick="NR_AIAssistant.showAIChat()" title="AI booking assistant">🤖 AI Help</button>
                    </div>

                    <!-- Features 15-20: Advanced Features -->
                    <div style="display:flex; gap:6px; margin-bottom:16px; flex-wrap:wrap;">
                        <button class="btn" style="background:#9C27B0; color:#fff; font-size:0.8em;" onclick="NR_Voice.startVoice()" title="Voice commands">🎤 Voice</button>
                        <button class="btn" style="background:#FF9800; color:#fff; font-size:0.8em;" onclick="NR_Promos.showPromoModal()" title="Apply promo codes">🎟️ Promo</button>
                        <button class="btn" style="background:#4CAF50; color:#fff; font-size:0.8em;" onclick="NR_Referrals.showReferralTree('user-1')" title="Referral earnings">🌳 Referrals</button>
                        <button class="btn" style="background:#E74C3C; color:#fff; font-size:0.8em;" onclick="NR_Admin.showAdminDashboard()" title="Admin dashboard">🛡️ Admin</button>
                    </div>

                        <button id="btn-end-booking-sitter" class="btn" style="background:#E74C3C; color:#fff;" onclick="NR_CheckIn.stopSession()" aria-label="End current booking (sitter)" hidden>End Booking</button>


                        <div style="display:flex; justify-content:space-between; align-items:center; gap:12px; margin-top:10px;">
                            <div style="font-weight:700; color:#2C3E50;">Trusted Circle</div>
                            <button class="btn" style="background:#87CEEB; color:#fff;" onclick="NR_Trusted.openContactsModal()">Manage</button>
                        </div>
                        <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">
                            <label for="checkin-interval" style="color:#2C3E50; font-weight:600;">Interval:</label>
                            <select id="checkin-interval" onchange="NR_CheckIn.updateIntervalFromSelect()" style="padding:8px 10px; border-radius:10px; border:1px solid #DDD;">
                                <option value="300">5 min</option>
                                <option value="600">10 min</option>
                                <option value="900">15 min</option>
                                <option value="1800">30 min</option>
                                <option value="3600" selected>60 min</option>
                            </select>
                        </div>
                </div>

                <div style="display:grid; grid-template-columns:repeat(2,1fr); gap:16px; margin-bottom:24px;">
                    <button style="background:white; border-radius:18px; padding:22px; text-align:center; box-shadow:0 4px 12px rgba(0,0,0,0.1); border:none; cursor:pointer;" onclick="sitterViewJobRequests()">
                        <div style="font-size:2.2rem; margin-bottom:8px;">🔎</div>
                        <div style="font-weight:600; color:#2C3E50;">Job Requests</div>
                    </button>
                    <button style="background:white; border-radius:18px; padding:22px; text-align:center; box-shadow:0 4px 12px rgba(0,0,0,0.1); border:none; cursor:pointer;" onclick="sitterViewSchedule()">
                        <div style="font-size:2.2rem; margin-bottom:8px;">📅</div>
                        <div style="font-weight:600; color:#2C3E50;">My Schedule</div>
                    </button>
                    <button style="background:white; border-radius:18px; padding:22px; text-align:center; box-shadow:0 4px 12px rgba(0,0,0,0.1); border:none; cursor:pointer;" onclick="sitterViewPayments()">
                        <div style="font-size:2.2rem; margin-bottom:8px;">💳</div>
                        <div style="font-weight:600; color:#2C3E50;">Payments</div>
                    </button>
                    <button style="background:white; border-radius:18px; padding:22px; text-align:center; box-shadow:0 4px 12px rgba(0,0,0,0.1); border:none; cursor:pointer;" onclick="sitterViewMessages()">
                        <div style="font-size:2.2rem; margin-bottom:8px;">💬</div>
                        <div style="font-weight:600; color:#2C3E50;">Messages</div>
                    </button>
                </div>

                <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:16px; margin-bottom:24px;">
                    <button style="background:white; border-radius:16px; padding:18px; text-align:center; box-shadow:0 4px 12px rgba(0,0,0,0.1); border:none; cursor:pointer;" onclick="sitterEditProfile()">
                        <div style="font-size:1.8rem; margin-bottom:6px;">👤</div>
                        <div style="font-weight:600; color:#2C3E50;">Profile</div>
                    </button>
                    <button style="background:white; border-radius:16px; padding:18px; text-align:center; box-shadow:0 4px 12px rgba(0,0,0,0.1); border:none; cursor:pointer;" onclick="sitterViewReviews()">
                        <div style="font-size:1.8rem; margin-bottom:6px;">⭐</div>
                        <div style="font-weight:600; color:#2C3E50;">Reviews</div>
                    </button>
                    <button style="background:white; border-radius:16px; padding:18px; text-align:center; box-shadow:0 4px 12px rgba(0,0,0,0.1); border:none; cursor:pointer;" onclick="sitterEditAvailability()">
                        <div style="font-size:1.8rem; margin-bottom:6px;">⏰</div>
                        <div style="font-weight:600; color:#2C3E50;">Availability</div>
                    </button>
                </div>

                <!-- Reminder card if onboarding incomplete -->
                <div id="sitter-onboarding-reminder" style="display:none; background:#FFF7ED; border:1px solid #FED7AA; color:#7C2D12; border-radius:14px; padding:14px; margin-bottom:16px;">
                    <div style="font-weight:700; margin-bottom:6px;">Finish setting up your sitter profile</div>
                    <div style="font-size:0.95rem; margin-bottom:10px;">Complete onboarding so parents can find and book you.</div>
                    <button class="btn" style="background:#FF8A65; color:white; margin:0;" onclick="resumeSitterOnboarding()">Finish Onboarding</button>
                </div>

                <div style="background:white; border-radius:20px; padding:22px; box-shadow:0 4px 12px rgba(0,0,0,0.1);">
                    <h4 style="margin-bottom:12px; color:#2C3E50; font-size:1.2rem;">Recent Activity</h4>

            <!-- Modal: Job Requests -->
            <div id="modal-job-requests" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.45); z-index:50; align-items:flex-end; justify-content:center;">

            <style>
                /* Focus trap helpers */
                .nr-visually-hidden { position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
            </style>
            <!-- Modal: Set Geo Center -->
            <div id="modal-geo-center" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.45); z-index:65; align-items:flex-end; justify-content:center;">
                <div style="width:100%; max-width:375px; background:#fff; border-top-left-radius:16px; border-top-right-radius:16px; padding:16px 16px 20px;">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                        <h3 style="margin:0; color:#2C3E50;">Set Geo Fence Center</h3>
                        <button class="btn" style="width:auto; padding:8px 12px; background:#EEE; margin:0;" onclick="NR_Geo.closeCenterModal()">Close</button>
                    </div>
                    <div style="display:flex; gap:8px; margin-bottom:10px;">
                        <input id="geo-lat" class="form-input" placeholder="Latitude" style="flex:1;">
                        <input id="geo-lon" class="form-input" placeholder="Longitude" style="flex:1;">
                    </div>
                    <div style="display:flex; gap:8px; margin-bottom:10px;">
                        <button class="btn" style="background:#87CEEB; color:#fff;" onclick="NR_Geo.useCurrentLocation()">Use Current Location</button>
                        <button class="btn" style="background:#6C63FF; color:#fff;" onclick="NR_Geo.saveCenter()">Save</button>
                    </div>
                    <div style="color:#7F8C8D; font-size:0.9rem;">Tip: Allow location permission or paste coordinates for demos.</div>
                </div>
            </div>
                <div style="width:100%; max-width:375px; background:#fff; border-top-left-radius:16px; border-top-right-radius:16px; padding:16px 16px 20px;">

            <!-- Modal: Trusted Contacts -->
            <div id="modal-trusted" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.45); z-index:60; align-items:flex-end; justify-content:center;">
                <div style="width:100%; max-width:375px; background:#fff; border-top-left-radius:16px; border-top-right-radius:16px; padding:16px 16px 20px;">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                        <h3 style="margin:0; color:#2C3E50;">Trusted Circle</h3>
                        <button class="btn" style="width:auto; padding:8px 12px; background:#EEE; margin:0;" onclick="NR_Trusted.closeContactsModal()">Close</button>
                    </div>
                    <div style="display:flex; gap:8px; margin-bottom:10px;">
                        <input id="trusted-name" class="form-input" placeholder="Full name" style="flex:1;">
                        <input id="trusted-contact" class="form-input" placeholder="Email or phone" style="flex:1;">
                    </div>
                    <div style="display:flex; gap:10px; align-items:center; margin-bottom:12px;">
                        <label style="display:flex; align-items:center; gap:6px; cursor:pointer;"><input id="trusted-notify" type="checkbox" checked> Notify on alerts</label>
                        <label style="display:flex; align-items:center; gap:6px; cursor:pointer;"><input id="trusted-viewonly" type="checkbox" checked> View-only</label>
                    </div>
                    <div style="display:flex; gap:8px;">
                        <button class="btn" style="background:#6C63FF; color:#fff;" onclick="NR_Trusted.addContact()">Add</button>
                        <button class="btn" style="background:#EEE; color:#333;" onclick="NR_Trusted.clearContacts()">Clear All</button>
                    </div>
                    <div id="trusted-list" style="display:flex; flex-direction:column; gap:10px; margin-top:12px;">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                        <h3 style="margin:0; color:#2C3E50;">Job Requests</h3>
                        <button class="btn" style="width:auto; padding:8px 12px; background:#EEE; margin:0;" onclick="closeJobRequests()">Close</button>
                    </div>
                    <div id="job-requests-list" style="display:flex; flex-direction:column; gap:10px;">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>

            <!-- Modal: Payments -->
            <div id="modal-payments" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.45); z-index:50; align-items:flex-end; justify-content:center;">
                <div style="width:100%; max-width:375px; background:#fff; border-top-left-radius:16px; border-top-right-radius:16px; padding:16px 16px 20px;">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                        <h3 style="margin:0; color:#2C3E50;">Payments</h3>
                        <button class="btn" style="width:auto; padding:8px 12px; background:#EEE; margin:0;" onclick="closePayments()">Close</button>
                    </div>
                    <div style="background:#FAFAFA; border-radius:12px; padding:12px; margin-bottom:12px;">
                        <div style="display:flex; justify-content:space-between; color:#2C3E50;">
                            <span>Total Earned</span>
                            <strong id="payments-total">$0.00</strong>
                        </div>
                        <div style="display:flex; justify-content:space-between; color:#2C3E50;">
                            <span>Pending Payout</span>
                            <strong id="payments-pending">$0.00</strong>
                        </div>
                    </div>
                    <div id="payments-history" style="display:flex; flex-direction:column; gap:8px;">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>
                    <ul style="margin:0; padding-left:18px; color:#2C3E50;">
                        <li>💳 Payment received from Johnson Family</li>
                        <li>✅ Booking confirmed for Friday, 7 PM</li>
                        <li>⭐ Parent left you a 5★ review</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Screen 4: Booking Page -->
        <div class="screen hidden" id="screen-3">
            <button class="back-btn" data-action="back" aria-label="Go back"><i class="fas fa-arrow-left"></i></button>

            <div style="padding: 30px; background: #FAFAFA;">
                <h2 style="margin-bottom: 30px; color: #2C3E50; text-align: center; padding-top: 20px;">Book a Sitter</h2>

                <div style="margin-bottom: 35px;">
                    <h4 style="margin-bottom: 20px; color: #2C3E50; font-size: 1.2rem;">📅 Select Date & Time</h4>
                    <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; margin-bottom: 20px;">
                        <div style="text-align: center; padding: 15px 8px; background: #F8F9FA; border-radius: 12px; font-size: 0.9rem; font-weight: 600;">S</div>
                        <div style="text-align: center; padding: 15px 8px; background: #F8F9FA; border-radius: 12px; font-size: 0.9rem; font-weight: 600;">M</div>
                        <div style="text-align: center; padding: 15px 8px; background: #FF69B4; color: white; border-radius: 12px; font-size: 0.9rem; font-weight: 600;">T</div>
                        <div style="text-align: center; padding: 15px 8px; background: #F8F9FA; border-radius: 12px; font-size: 0.9rem; font-weight: 600;">W</div>
                        <div style="text-align: center; padding: 15px 8px; background: #F8F9FA; border-radius: 12px; font-size: 0.9rem; font-weight: 600;">T</div>
                        <div style="text-align: center; padding: 15px 8px; background: #F8F9FA; border-radius: 12px; font-size: 0.9rem; font-weight: 600;">F</div>
                        <div style="text-align: center; padding: 15px 8px; background: #F8F9FA; border-radius: 12px; font-size: 0.9rem; font-weight: 600;">S</div>
                    </div>
                    <div style="display: flex; gap: 12px;">
                        <button style="flex: 1; padding: 15px; background: #87CEEB; color: white; border: none; border-radius: 15px; font-weight: 600; cursor: pointer;" onclick="selectTimeSlot('7:00 PM')">7:00 PM</button>
                        <button style="flex: 1; padding: 15px; background: #F8F9FA; border: none; border-radius: 15px; font-weight: 600; cursor: pointer;" onclick="selectTimeSlot('8:00 PM')">8:00 PM</button>
                        <button style="flex: 1; padding: 15px; background: #F8F9FA; border: none; border-radius: 15px; font-weight: 600; cursor: pointer;" onclick="selectTimeSlot('9:00 PM')">9:00 PM</button>
                    </div>
                </div>


                <div style="margin-bottom: 35px;">
                    <h4 style="margin-bottom: 20px; color: #2C3E50; font-size: 1.2rem;">📍 Location</h4>
                    <div style="background: white; border-radius: 15px; padding: 20px; display: flex; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <i class="fas fa-map-marker-alt" style="color: #FF69B4; margin-right: 15px; font-size: 1.2rem;"></i>
                        <span style="font-size: 1.1rem;">123 Main St, Your City</span>
                    </div>
                </div>


                <div style="margin-bottom: 100px;">
                    <h4 style="margin-bottom: 20px; color: #2C3E50; font-size: 1.2rem;">👩‍🦰 Available Sitters</h4>
                    <div style="background: white; border-radius: 20px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 20px; cursor: pointer; transition: transform 0.2s;" onclick="viewSitterProfile()" ontouchstart="this.style.transform='scale(0.98)'" ontouchend="this.style.transform='scale(1)'">
                        <div style="display: flex; align-items: center;">
                            <div style="width: 70px; height: 70px; background: linear-gradient(135deg, #FF69B4, #87CEEB); border-radius: 50%; margin-right: 20px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.8rem; font-weight: bold;">E</div>
                            <div style="flex: 1;">
                                <div style="font-weight: 700; margin-bottom: 8px; font-size: 1.2rem;">Emma Johnson</div>
                                <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                    <span style="color: #F39C12; font-size: 1.1rem;">⭐⭐⭐⭐⭐</span>
                                    <span style="margin-left: 10px; font-size: 1rem; color: #7F8C8D;">4.9 (127)</span>
                                </div>
                                <div style="color: #FF69B4; font-weight: 700; font-size: 1.2rem;">$25/hour</div>
                            </div>
                            <div style="background: #FF69B4; color: white; padding: 12px 20px; border-radius: 25px; font-size: 1rem; font-weight: 600;">View Profile</div>
                        </div>
                    </div>
                </div>

                <button style="display: block; position: static; width: calc(100% - 60px); margin: 20px auto 20px; background: #FF69B4; color: white; border: none; padding: 20px; border-radius: 30px; font-size: 1.2rem; font-weight: 700; box-shadow: 0 8px 25px rgba(255,105,180,0.3); transition: transform 0.2s;" onclick="proceedToPayment()" ontouchstart="this.style.transform='scale(0.98)'" ontouchend="this.style.transform='scale(1)'">
                    Book Now - $100
                </button>
            </div>
        </div>
        <!-- Screen 5: Sitter Profile -->

        <div class="screen hidden" id="screen-4">
            <div style="background: #FAFAFA;">
                <div style="position: relative;">
                    <div style="height: 250px; background: linear-gradient(135deg, #FF69B4, #87CEEB); display: flex; align-items: center; justify-content: center; position: relative;">
                        <div style="width: 140px; height: 140px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 4rem; color: #FF69B4; box-shadow: 0 8px 25px rgba(0,0,0,0.2);">👩‍🦰</div>

                        <div style="position: absolute; top: 30px; right: 30px; background: #2ECC71; color: white; padding: 10px 15px; border-radius: 25px; font-size: 0.9rem; font-weight: 600;">
                            ✓ Verified
                    </button>

                        </div>
                    </div>
                </div>

                <div style="padding: 30px;">
                    <div style="text-align: center; margin-bottom: 35px;">
                        <h2 style="margin-bottom: 8px; font-size: 2rem;">Emma Johnson</h2>
                        <div style="color: #7F8C8D; margin-bottom: 15px; font-size: 1.1rem;">📍 2.3 miles away</div>
                        <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 15px;">
                            <span style="color: #F39C12; font-size: 1.3rem;">⭐⭐⭐⭐⭐</span>
                            <span style="margin-left: 12px; color: #7F8C8D; font-size: 1.1rem;">4.9 (127 reviews)</span>
                        </div>
                        <div style="color: #FF69B4; font-size: 2rem; font-weight: 800;">$25/hour</div>
                    </div>

                    <div style="margin-bottom: 35px;">
                        <h4 style="margin-bottom: 20px; font-size: 1.3rem;">About Me</h4>
                        <p style="color: #7F8C8D; line-height: 1.6; font-size: 1.1rem;">Experienced childcare provider with 5+ years caring for children ages 6 months to 12 years. CPR certified and background checked.</p>
                    </div>

                    <div style="margin-bottom: 35px;">
                        <h4 style="margin-bottom: 20px; font-size: 1.3rem;">Skills & Certifications</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 12px;">
                            <span style="background: #FFB6C1; color: #C71585; padding: 10px 16px; border-radius: 25px; font-size: 0.9rem; font-weight: 600;">CPR Certified</span>
                            <span style="background: #B0E0E6; color: #4682B4; padding: 10px 16px; border-radius: 25px; font-size: 0.9rem; font-weight: 600;">First Aid</span>
                            <span style="background: #FFB6C1; color: #C71585; padding: 10px 16px; border-radius: 25px; font-size: 0.9rem; font-weight: 600;">Newborn Care</span>
                            <span style="background: #B0E0E6; color: #4682B4; padding: 10px 16px; border-radius: 25px; font-size: 0.9rem; font-weight: 600;">Homework Help</span>
                        </div>
                    </div>


        // Parent wizard routing and validation
        function gotoParentStep(step){
            if(step>1){
                if(!validateParentStep(step-1)){
                    alert('Please complete the required fields (*) before continuing.');
                    return;
                }
            }
            const map = {0:'parent-screen-0',1:'parent-step-1',2:'parent-step-2',3:'parent-step-3',4:'parent-step-4',5:'parent-step-5',6:'parent-step-6',7:'parent-step-7',8:'parent-step-8',9:'parent-step-9'};
            showScreenById(map[step]);
        }
        function validateParentStep(step){
            const must = [];
            switch(step){
                case 1: must.push('#pa-fullname','#pa-phone','#pa-email'); break;
                case 2: must.push('#pa-city','#pa-zip'); break;
                case 3: must.push('#pa-children','#pa-ages'); break;
                case 4: /* at least one pet OR none required? require at least one */ break;
                case 5: must.push('#pa-hours','#pa-oncall'); break;
                case 6: must.push('#pa-emerg-name','#pa-emerg-phone'); break;
                case 7: must.push('#pa-autopay','#pa-credits'); break;
                case 8: must.push('#pa-consent-review','#pa-consent-share','#pa-show-other'); break;
                case 9: must.push('#pa-terms','#pa-safety','#pa-disclaimer','#pa-signature'); break;
            }
            for(const sel of must){
                if(!sel) continue; const el=document.querySelector(sel); if(!el) continue;
                if(el.type==='checkbox' || el.type==='radio'){ if(!el.checked) return false; }
                else if((el.value||'').trim()==='') return false;
            }
            if(step===4){
                const anyPet = document.querySelector('.pa-pet:checked');
                if(!anyPet) return false;
            }
            if(step===7){
                const selectedPay = document.querySelector('input[name="pa-pay"]:checked');
                if(!selectedPay) return false;
            }
            if(step===5){
                const anyBook = document.querySelector('.pa-book:checked');
                if(!anyBook) return false;
            }
            return true;
        }
        function finishParentOnboarding(){
            if(!validateParentStep(9)) { alert('Please complete all required items.'); return; }
            try{
                const user = JSON.parse(localStorage.getItem('nr-demo-user')||'{}');
                user.role='parent'; user.isOnboarded=true;
                user.parent = {
                    fullname: (document.getElementById('pa-fullname')||{}).value||'',
                    phone: (document.getElementById('pa-phone')||{}).value||'',
                    email: (document.getElementById('pa-email')||{}).value||'',
                    city: (document.getElementById('pa-city')||{}).value||'',
                    zip: (document.getElementById('pa-zip')||{}).value||'',
                    children: (document.getElementById('pa-children')||{}).value||'',
                    ages: (document.getElementById('pa-ages')||{}).value||'',
                    allergies: (document.getElementById('pa-allergies')||{}).value||'',
                    pets: Array.from(document.querySelectorAll('.pa-pet:checked')).map(el=>el.value),
                    bookingPrefs: Array.from(document.querySelectorAll('.pa-book:checked')).map(el=>el.value),
                    hours: (document.getElementById('pa-hours')||{}).value||'',
                    oncall: (document.getElementById('pa-oncall')||{}).checked||false,
                    emergName: (document.getElementById('pa-emerg-name')||{}).value||'',
                    emergPhone: (document.getElementById('pa-emerg-phone')||{}).value||'',
                    payMethod: (document.querySelector('input[name="pa-pay"]:checked')||{}).value||'',
                    autopay: (document.getElementById('pa-autopay')||{}).checked||false,
                    credits: (document.getElementById('pa-credits')||{}).checked||false,
                    consentReview: (document.getElementById('pa-consent-review')||{}).checked||false,
                    consentShare: (document.getElementById('pa-consent-share')||{}).checked||false,
                    showOther: (document.getElementById('pa-show-other')||{}).checked||false,
                    terms: (document.getElementById('pa-terms')||{}).checked||false,
                    safety: (document.getElementById('pa-safety')||{}).checked||false,
                    disclaimer: (document.getElementById('pa-disclaimer')||{}).checked||false,
                    signature: (document.getElementById('pa-signature')||{}).value||'',
                };
                localStorage.setItem('nr-demo-user', JSON.stringify(user));
            }catch(e){}
            if (typeof window.__refreshDashboardRoleView === 'function') window.__refreshDashboardRoleView();
            alert('🎉 Parent onboarding complete!');
            showScreenById('screen-2');
        }

                    <div style="display: flex; gap: 20px; margin-top: 40px; padding-bottom: 100px;">
                        <button style="flex: 1; background: #87CEEB; color: white; border: none; padding: 18px; border-radius: 30px; font-weight: 700; font-size: 1.1rem; transition: transform 0.2s;" onclick="sendMessage()" ontouchstart="this.style.transform='scale(0.98)'" ontouchend="this.style.transform='scale(1)'">
                            💬 Message
                        </button>

                        <button style="flex: 1; background: #FF69B4; color: white; border: none; padding: 18px; border-radius: 30px; font-weight: 700; font-size: 1.1rem; transition: transform 0.2s;" onclick="proceedToPayment()" ontouchstart="this.style.transform='scale(0.98)'" ontouchend="this.style.transform='scale(1)'">
                            📅 Book Now
                        </button>
                    </div>
                </div>
            </div>


        </div>
            <!-- Settings screen -->
            <div class="screen hidden" id="screen-6">
                <div style="padding: 30px; background: var(--bg); min-height: 100%;">
                    <button class="back-btn" onclick="prevScreen()" aria-label="Go back"><i class="fas fa-arrow-left"></i></button>
                    <h2 style="margin: 20px 0 24px; color: var(--text);">Settings</h2>

                    <div style="background: var(--card); color: var(--text); border: 1px solid var(--border); border-radius: 16px; padding: 18px; margin-bottom: 16px;">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <div>
                                <div style="font-weight:700;">Theme</div>
                                <div style="color: var(--muted); font-size: 0.95rem;">Choose Dark or Light</div>
                            </div>
                            <div style="display:flex; gap:10px;">
                                <button class="btn" style="width:auto; padding:10px 14px; background:#222; color:#fff;" onclick="setTheme('dark')">Dark</button>
                                <button class="btn" style="width:auto; padding:10px 14px; background:#fff; color:#333;" onclick="setTheme('light')">Light</button>
                                <button class="btn" style="width:auto; padding:10px 14px; background:#87CEEB; color:#fff;" onclick="setTheme('auto')">Auto</button>
                            </div>
                        </div>
                    </div>

                    <p style="color: var(--muted); font-size: 0.9rem;">Your selection is saved on this device.</p>
                </div>
            </div>


        <!-- Screen 6: Payment Screen -->
        <div class="screen hidden" id="screen-5">
            <button class="back-btn" data-action="back" aria-label="Go back"><i class="fas fa-arrow-left"></i></button>

            <div style="padding: 30px; background: #FAFAFA;">
                <h2 style="margin-bottom: 40px; color: #2C3E50; text-align: center; padding-top: 20px; font-size: 1.8rem;">Payment</h2>


                <div style="background: white; border-radius: 20px; padding: 25px; margin-bottom: 35px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                    <h4 style="margin-bottom: 20px; color: #2C3E50; font-size: 1.3rem;">Booking Summary</h4>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 12px; font-size: 1.1rem;">
                        <span>Sitter: Emma Johnson</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 12px; font-size: 1.1rem;">
                        <span>Date: Today, 7:00 PM - 11:00 PM</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 20px; font-size: 1.1rem;">
                        <span>Duration: 4 hours</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding-top: 20px; border-top: 2px solid #F0F0F0;">
                        <span style="font-weight: 700; font-size: 1.2rem;">Total:</span>
                        <span style="font-weight: 800; color: #FF69B4; font-size: 1.5rem;">$100.00</span>
                    </div>

        // Extra safety: bind Get Started to always go to step 1
        document.addEventListener('click', function(ev){
            const t = ev.target;
            if(!t) return;
            if(t.id === 'sitter-get-started' || (t.matches && t.matches('#sitter-get-started'))){
                ev.preventDefault();
                if(typeof gotoSitterStep === 'function') gotoSitterStep(1);
                else showScreenById('sitter-step-1');
            }
        }, true);

                </div>

                <div style="margin-bottom: 35px;">
                    <h4 style="margin-bottom: 20px; color: #2C3E50; font-size: 1.3rem;">Payment Method</h4>
                    <div style="background: white; border: 3px solid #FF69B4; border-radius: 15px; padding: 20px; margin-bottom: 15px; display: flex; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <i class="fab fa-cc-stripe" style="font-size: 1.8rem; color: #6772E5; margin-right: 20px;"></i>
                        <div>
                            <div style="font-weight: 700; font-size: 1.1rem;">•••• •••• •••• 4242</div>
                            <div style="font-size: 1rem; color: #7F8C8D;">Expires 12/25</div>
                        </div>
                        <i class="fas fa-check-circle" style="color: #FF69B4; margin-left: auto; font-size: 1.3rem;"></i>
                    </div>
                    <div style="background: white; border-radius: 15px; padding: 20px; display: flex; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <i class="fab fa-paypal" style="font-size: 1.8rem; color: #0070BA; margin-right: 20px;"></i>
                        <span style="font-size: 1.1rem;">PayPal</span>
                    </div>
                </div>

                <div style="margin-bottom: 35px;">

        // Sitter onboarding helpers
        function startSitterOnboarding(){
            try {
                const user = JSON.parse(localStorage.getItem('nr-demo-user')||'{}');
                user.role = 'sitter';
                user.isOnboarded = false;
                localStorage.setItem('nr-demo-user', JSON.stringify(user));
            } catch(e) {}
            showScreenById('screen-10');
        }
        function gotoSitterStep(step){
            const map = {1:'sitter-step-1',2:'sitter-step-2',3:'sitter-step-3',4:'sitter-step-4',5:'sitter-step-5',6:'sitter-step-6',7:'sitter-step-7',8:'sitter-step-8',9:'sitter-step-9',10:'sitter-step-10',11:'sitter-step-11',12:'sitter-step-12'};
            showScreenById(map[step]);
        }

        function validateSitterStep(step){
            // Minimal client-only validation for required fields marked with *
            const must = [];
            switch(step){
                case 1: must.push('#si-fullname','#si-dob','#si-phone'); break;
                case 2: must.push('#si-email','#si-nickname','#si-privacy'); break;
                case 3: must.push('#si-consent'); break;
                case 4: must.push('#si-languages'); break;
                case 5: must.push('#si-overnight','#si-oncall'); break;
                case 6: must.push(); break;
                case 7: must.push('#si-emergency'); break;
                case 8: must.push('#si-rate'); break;
                case 9: must.push('#si-ref1','#si-ref2'); break;
                case 10: must.push('#si-bio','#si-enjoy'); break;
                case 11: must.push('#si-terms','#si-safety','#si-signature'); break;
                default: break;
            }
            for(const sel of must){
                if(!sel) continue;
                const el = document.querySelector(sel);
                if(!el) continue;
                if(el.type==='checkbox' || el.type==='radio'){
                    if(!el.checked) return false;
                } else {
                    if((el.value||'').trim()==='') return false;
                }
            }
            // Extra validations: at least one day selected on step 5, one hobby on step 10
            if(step===5){
                const anyDay = document.querySelector('.ai-day:checked');
                if(!anyDay) return false;
            }
            if(step===10){
                const anyHobby = document.querySelector('.ai-hobby:checked');
                if(!anyHobby) return false;
            }

            return true;
        }

        // Intercept gotoSitterStep to enforce validation (wrapper placed outside the function)
        (function(){
            const __origGoto = gotoSitterStep;
            window.gotoSitterStep = function(step){
                if(step>1){
                    const ok = validateSitterStep(step-1);
                    if(!ok){ alert('Please complete the required fields (*) before continuing.'); return; }
                }
                __origGoto(step);
            };
        })();

        function finishSitterOnboarding(){
            try {
                const user = JSON.parse(localStorage.getItem('nr-demo-user')||'{}');
                user.isOnboarded = true;
                // Store a condensed sitter profile from steps (demo only)
                user.sitter = {
                    fullname: (document.getElementById('si-fullname')||{}).value || '',
                    nickname: (document.getElementById('si-nickname')||{}).value || '',
                    dob: (document.getElementById('si-dob')||{}).value || '',
                    city: (document.getElementById('si-city')||{}).value || '',
                    state: (document.getElementById('si-state')||{}).value || '',
                    phone: (document.getElementById('si-phone')||{}).value || '',
                    email: (document.getElementById('si-email')||{}).value || '',
                    privacyFirstNameOnly: (document.getElementById('si-privacy')||{}).checked || false,
                    years: (document.getElementById('si-years')||{}).value || '0',
                    skills: Array.from(document.querySelectorAll('.si-skill:checked')).map(el=>el.value),
                    certs: (document.getElementById('si-certs')||{}).value || '',
                    languages: (document.getElementById('si-languages')||{}).value || '',
                    rate: (document.getElementById('si-rate')||{}).value || '',
                    weekend: (document.getElementById('si-weekend')||{}).checked || false,
                    overnight: (document.getElementById('si-overnight')||{}).checked || false,
                    oncall: (document.getElementById('si-oncall')||{}).checked || false,
                };
                localStorage.setItem('nr-demo-user', JSON.stringify(user));
            } catch(e) {}
            alert('🎉 Step complete! Continue to the next step.');
            showScreenById('sitter-step-12');
        }
        try{ window.startSitterOnboarding=startSitterOnboarding; window.finishSitterOnboarding=finishSitterOnboarding; }catch(e){}

                    <h4 style="margin-bottom: 20px; color: #2C3E50; font-size: 1.3rem;">Promo Code</h4>
                    <div style="display: flex; gap: 15px;">
                        <input type="text" placeholder="Enter promo code" style="flex: 1; padding: 18px; border: 2px solid #F0F0F0; border-radius: 15px; font-size: 1.1rem; background: white;">
                        <button style="background: #87CEEB; color: white; border: none; padding: 18px 25px; border-radius: 15px; font-weight: 600; font-size: 1.1rem; cursor: pointer;" onclick="applyPromoCode()">Apply</button>
                    </div>
                </div>

                <button style="width: 100%; background: #FF69B4; color: white; border: none; padding: 20px; border-radius: 30px; font-size: 1.3rem; font-weight: 700; margin-top: 30px; margin-bottom: 20px; box-shadow: 0 8px 25px rgba(255,105,180,0.3); transition: transform 0.2s;" onclick="confirmPayment()" ontouchstart="this.style.transform='scale(0.98)'" ontouchend="this.style.transform='scale(1)'">
                    Confirm Payment - $100.00
                </button>

                <p style="text-align: center; margin-top: 20px; font-size: 1rem; color: #7F8C8D; margin-bottom: 40px;">
                    🔒 Your payment is secure and encrypted
                </p>
            </div>
        </div>
        </div>


</div>

    <script>
        let currentScreen = 0;
        const getScreens = () => Array.from(document.querySelectorAll('.mobile-container .screen')).filter(el => !el.closest('.phone-mockup'));

        function updateNavigation() {
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach((item, index) => {
                item.classList.toggle('active', index === currentScreen);
            });

        // Bind role buttons as a backup after DOM is ready
        document.addEventListener('DOMContentLoaded', function(){
            const sitterBtn = document.getElementById('btnRoleSitter');
            const parentBtn = document.getElementById('btnRoleParent');
            if(sitterBtn){
                sitterBtn.addEventListener('click', function(e){
                    e.preventDefault(); e.stopPropagation();
                    if(typeof startSitterOnboarding === 'function') startSitterOnboarding();
                    else showScreenById('screen-10');
                }, {passive:false});
            }
            if(parentBtn){
                parentBtn.addEventListener('click', function(e){
                    e.preventDefault(); e.stopPropagation();
                    if(typeof gotoParentStep === 'function') gotoParentStep(0);
                    else showScreenById('parent-screen-0');
                }, {passive:false});
            }
        });

        }

        function showScreen(index) {
            const screens = Array.from(getScreens());
            if (!screens.length) return;
            const maxIndex = screens.length - 1;
            if (index < 0) index = 0;
            if (index > maxIndex) index = maxIndex;


        // Onboarding logic (global scope)
        function selectRole(role) {
            try {
                const user = JSON.parse(localStorage.getItem('nr-demo-user')||'{}');
                user.role = role;
                user.isOnboarded = false;
                localStorage.setItem('nr-demo-user', JSON.stringify(user));
            } catch(e) {}
            if (role === 'parent') {
                showScreenById('parent-screen-0');
            } else {
                showScreenById('screen-10');
            }
        }

        function completeOnboarding() {
            // Deprecated shortcut removed to prevent bypass.
            alert('Please use the step-by-step onboarding to continue.');
        }

        function showSitterAllInOne(){
            const container = document.getElementById('sitter-allinone');
            const btn = document.getElementById('sitter-get-started');
            const bar = document.getElementById('sitter-progress');
            const label = document.getElementById('sitter-progress-label');
            if(container){ container.style.display='block'; }
            if(btn){ btn.style.display='none'; }
            if(bar){ bar.style.width='100%'; }
            if(label){ label.textContent='All-in-one (disabled)'; }
        }

        function completeSitterAllInOne(){
            // Disabled to prevent onboarding bypass
            alert('Please complete the step-by-step onboarding.');
        }

        try{ window.showSitterAllInOne = showSitterAllInOne; window.completeSitterAllInOne = completeSitterAllInOne; }catch(e){}


        try { window.selectRole = selectRole; window.completeOnboarding = completeOnboarding; } catch(e) {}

            screens.forEach((screen, i) => {
                screen.classList.remove('next', 'prev', 'active');
                if (i === index) {
                    screen.classList.add('active');
                } else if (i < index) {
                    screen.classList.add('prev');
                } else {
                    screen.classList.add('next');
                }
            });

            currentScreen = index;
        }


        // Helper: show a specific screen by element id
        function showScreenById(id){
            // If a safer override exists, delegate to it
            if (window.showScreenById && window.showScreenById !== showScreenById) {
                return window.showScreenById(id);
            }
            const el = document.getElementById(id);
            if(!el) return;
            const screens = Array.from(getScreens());
            const index = screens.indexOf(el);
            if(index === -1){
                screens.forEach(s=>s.classList.remove('next','prev','active'));
                el.classList.add('active');
                currentScreen = 0;
                if(typeof updateNavigation==='function') updateNavigation();
                return;
            }
            screens.forEach((screen,i)=>{
                screen.classList.remove('next','prev','active');
                if(i===index) screen.classList.add('active');
                else if(i<index) screen.classList.add('prev');
                else screen.classList.add('next');
            });
            currentScreen = index;
            if(typeof updateNavigation==='function') updateNavigation();
        }

        // Back button: if on sitter step 1, go to role chooser instead of generic prev
        (function(){
            const origPrev = prevScreen;
            window.prevScreen = function(){
                const screens = Array.from(getScreens());
                const currentEl = screens[currentScreen];
                if(currentEl && currentEl.id === 'sitter-step-1'){
                    showScreenById('screen-8'); // role chooser
                    return;
                }
                origPrev();
            };
        })();


        // Re-define showScreenById with a self-contained navigator (avoids relying on broken showScreen)
        (function(){
            window.showScreenById = function(id){
                const el = document.getElementById(id);
                if(!el) return;
                const screens = Array.from(getScreens());
                let index = screens.indexOf(el);
                // If the element isn't in the indexed list (e.g., dynamic insert), just activate it and deactivate others
                if(index === -1){
                    screens.forEach(s=>s.classList.remove('next','prev','active'));
                    el.classList.add('active');
                    currentScreen = 0;
                    if(typeof updateNavigation==='function') updateNavigation();
                    return;
                }
                screens.forEach((screen,i)=>{
                    screen.classList.remove('next','prev','active');
                    if(i===index) screen.classList.add('active');
                    else if(i<index) screen.classList.add('prev');
                    else screen.classList.add('next');
                });
                currentScreen = index;
                if(typeof updateNavigation==='function') updateNavigation();
            };
        })();


        // Sign Up: validate and simulate account creation
        function createAccount(){
            const name = (document.getElementById('signup-name')||{}).value||'';
            const email = (document.getElementById('signup-email')||{}).value||'';
            const pass = (document.getElementById('signup-password')||{}).value||'';
            const pass2 = (document.getElementById('signup-password2')||{}).value||'';
            if(!name.trim()) return alert('Please enter your full name');
            if(!email.match(/^[^@\s]+@[^@\s]+\.[^@\s]+$/)) return alert('Please enter a valid email');
            if(pass.length < 6) return alert('Password must be at least 6 characters');
            if(pass !== pass2) return alert('Passwords do not match');
            try{ localStorage.setItem('nr-demo-user', JSON.stringify({name, email, password: pass, isOnboarded: false})); }catch(e){}
            alert('✅ Account created!\n\nWelcome, '+name+'! Let\'s complete onboarding.');
            const emailInput = document.getElementById('email-input');
            const passwordInput = document.getElementById('password-input');
            if(emailInput) emailInput.value = email;
            if(passwordInput) passwordInput.value = pass;
            // Go to onboarding: choose role
            showScreenById('screen-8');
        }
        // Expose for inline onclick handlers
        try { window.showScreenById = showScreenById; window.createAccount = createAccount; } catch(e) {}


        function nextScreen() {
            showScreen(currentScreen + 1);
        }

        // FrontForceAI: Unified navigation click router
        document.addEventListener('click', function(e){
            const t = e.target.closest('button, a');
            if(!t) return;
            const action = t.getAttribute('data-action');
            if(!action) return;
            e.preventDefault(); e.stopPropagation();
            if(action==='auth'){
                const role=t.getAttribute('data-role')||'parent';
                try{ goToAuth(role); }catch(_){ showScreen(1); }
                return;
            }
            if(action==='choose-role'){
                const role=t.getAttribute('data-role');
                if(role==='parent'){ try{ gotoParentStep&&gotoParentStep(0); }catch(_){ showScreenById('screen-9'); } }
                else if(role==='sitter'){ try{ startSitterOnboarding?startSitterOnboarding():showScreenById('screen-10'); }catch(_){ showScreenById('screen-10'); } }
                return;
            }
            if(action==='goto-screen'){
                const target=t.getAttribute('data-target'); if(target) showScreenById(target);
                return;
            }
            if(action==='back'){
                // Back rule: if current is sitter-step-1, always go to role chooser screen
                const screens = Array.from(document.querySelectorAll('.screen'));
                const cur = screens[window.currentScreen] || null;
                if(cur && cur.id==='sitter-step-1'){ showScreenById('screen-8'); return; }
                try{ prevScreen(); }catch(_){ /*noop*/ }
                return;
            }
        }, true);

        // Landing buttons route to Auth with role context
        function goToAuth(role) {

        // Safety: if sitter onboarding screens are not registered, show fallback jumper
        (function(){
            function check(){
                const screens = Array.from(getScreens());
                const hasSitter = screens.some(s => s.id==='screen-10' || /^sitter-step-/.test(s.id));
                const fb = document.getElementById('sitter-onboarding-fallback');
                if(fb) fb.style.display = hasSitter ? 'none' : 'block';
            }
            document.addEventListener('DOMContentLoaded', check);
            setTimeout(check, 0);
        })();
            window.__userRole = role; // 'parent' or 'sitter'
            showScreen(1);
        }

        function prevScreen() {
            if (currentScreen > 0) {
                showScreen(currentScreen - 1);
            }
        }

        // App-specific functions
        function handleLogin() {
            const email = document.getElementById('email-input').value;
            const password = document.getElementById('password-input').value;

            if (!email || !password) {
                alert('📧 Please enter both email and password');
                return;
            }
            if (!email.includes('@')) {
                alert('📧 Please enter a valid email address');
                return;
            }

            let storedUser = null;
            try { storedUser = JSON.parse(localStorage.getItem('nr-demo-user') || 'null'); } catch (e) {}

            alert('🔄 Logging in...');
            setTimeout(() => {
                // If this is the created user and onboarding not finished, route to onboarding
                if (storedUser && storedUser.email === email && storedUser.password === password && !storedUser.isOnboarded) {

        // Hide design sections any time onboarding is visible
        (function(){
            function toggleMarketing(){
                const anyOnboardingVisible = !!document.querySelector('.screen.active#screen-8, .screen.active#screen-10, .screen.active[id^="sitter-step-"], .screen.active[id^="parent-step-"], .screen.active#parent-screen-0');
                const nodes = document.querySelectorAll('.phone-mockup, [data-section="design-features"]');
                nodes.forEach(n=>{ n.style.display = anyOnboardingVisible ? 'none' : ''; });
            }
            const mo = new MutationObserver(toggleMarketing);
            mo.observe(document.body, {subtree:true, attributes:true, attributeFilter:['class']});
            document.addEventListener('click', toggleMarketing, true);
            document.addEventListener('DOMContentLoaded', toggleMarketing);
            toggleMarketing();
        })();
                    alert('✅ Login successful! Let\'s finish onboarding.');
                    showScreenById('screen-8');
                    return;
                }
                // Otherwise, proceed to dashboard
                alert('✅ Login successful! Welcome to NannyRadar 🎉');
                showScreenById('screen-2');
            }, 600);
        }

        function findSitter() {
            alert('🔍 Searching for available sitters in your area...');
            setTimeout(() => {
                showScreen(3); // Go to booking page
            }, 800);
        }

        function viewSitterProfile() {
            alert('👩‍🦰 Loading Emma Johnson\'s profile...');
            setTimeout(() => {
                showScreen(4); // Go to sitter profile
            }, 600);
        }

        function proceedToPayment() {
            alert('💳 Proceeding to secure payment...');
            setTimeout(() => {
                showScreen(5); // Go to payment
            }, 700);
        }

        function confirmPayment() {
            try { NR_UI.toast('💳 Processing payment...', 'warning'); } catch(e) { alert('💳 Processing payment...'); }
            setTimeout(() => {
                try { NR_UI.toast('🎉 Payment successful! Booking confirmed. Check-ins required.', 'success'); } catch(e) { alert('🎉 Payment successful! Booking confirmed.'); }
                try { if (window.NR_CheckIn && typeof NR_CheckIn.startSession === 'function') NR_CheckIn.startSession(); } catch(e) {}
                showScreen(2); // Back to dashboard
            }, 1200);

        // Switch dashboard based on role
        (function(){
            const showDash = ()=>{
                let user = null; try{ user = JSON.parse(localStorage.getItem('nr-demo-user')||'null'); }catch(e){}
                const parentDash = document.getElementById('parent-dashboard');
                const sitterDash = document.getElementById('sitter-dashboard');
                if(user && user.role === 'sitter'){
                    if(parentDash) parentDash.style.display = 'none';
                    if(sitterDash) sitterDash.style.display = 'block';
                } else {
                    if(parentDash) parentDash.style.display = 'block';
                    if(sitterDash) sitterDash.style.display = 'none';
                }
            };
            window.addEventListener('load', showDash);
            document.addEventListener('DOMContentLoaded', showDash);
            try{ window.__refreshDashboardRoleView = showDash; }catch(e){}
        })();

        // Sitter dashboard actions
        function sitterViewJobRequests(){
            const modal = document.getElementById('modal-job-requests');
            const list = document.getElementById('job-requests-list');
            if(list){
                list.innerHTML = '';
                const sample = [
                    { family:'Johnson', when:'Fri, 7–10 PM', location:'Downtown', pay:'$75' },
                    { family:'Garcia', when:'Sat, 2–6 PM', location:'Uptown', pay:'$80' }
                ];
                sample.forEach((req)=>{
                    const card = document.createElement('div');
                    card.style.cssText = 'background:#FAFAFA; border-radius:12px; padding:12px; display:flex; justify-content:space-between; align-items:center; gap:10px;';
                    card.innerHTML = `<div style="color:#2C3E50;"><div style="font-weight:700;">${req.family} Family</div><div style="font-size:0.92rem;">📅 ${req.when} · 📍 ${req.location}</div><div style="font-size:0.92rem;">💳 ${req.pay}</div></div>
                    <div style="display:flex; gap:8px;"><button class="btn" style="width:auto; padding:10px 12px; margin:0; background:#87CEEB; color:white;" onclick="acceptJob('${req.family}')">Accept</button><button class="btn" style="width:auto; padding:10px 12px; margin:0; background:#EEE;" onclick="declineJob('${req.family}')">Decline</button></div>`;
                    list.appendChild(card);
                });
            }
            if(modal){ modal.style.display='flex'; }
        }
        function closeJobRequests(){ const m=document.getElementById('modal-job-requests'); if(m) m.style.display='none'; }
        function acceptJob(family){ alert(`✅ Accepted job request from ${family} Family`); closeJobRequests(); }
        function declineJob(family){ alert(`❌ Declined job request from ${family} Family`); }

        function sitterViewSchedule(){ alert('📅 Schedule: Calendar of your confirmed jobs.'); }

        function sitterViewPayments(){
            const modal = document.getElementById('modal-payments');
            const total = document.getElementById('payments-total');
            const pending = document.getElementById('payments-pending');
            const history = document.getElementById('payments-history');
            if(total) total.textContent = '$255.00';

            if(pending) pending.textContent = '$80.00';
            if(history){
                history.innerHTML = '';
                const items = [
                    { label:'Payout initiated', amount:'$175.00', date:'Tue' },
                    { label:'Johnson Family • Fri 7–10 PM', amount:'$75.00', date:'Fri' },
                    { label:'Garcia Family • Thu 5–8 PM', amount:'$80.00', date:'Thu' }
                ];
                items.forEach((it)=>{
                    const row = document.createElement('div');
                    row.style.cssText = 'display:flex; justify-content:space-between; background:#FAFAFA; border-radius:10px; padding:10px; color:#2C3E50;';
                    row.innerHTML = `<span>${it.label}</span><span><strong>${it.amount}</strong> · <span style="opacity:0.7;">${it.date}</span></span>`;
                    history.appendChild(row);
                });
            }
            if(modal){ modal.style.display='flex'; }
        }
        function closePayments(){ const m=document.getElementById('modal-payments'); if(m) m.style.display='none'; }

        function sitterViewMessages(){ alert('💬 Messages: Chat with parents.'); }
        function sitterEditProfile(){ alert('👤 Profile: Edit your sitter details and rates.'); }
        function sitterViewReviews(){ alert('⭐ Reviews: See feedback from parents.'); }

        // Show reminder card on sitter dashboard if onboarding incomplete
        (function(){
            const updateReminder = ()=>{
                let user=null; try{ user=JSON.parse(localStorage.getItem('nr-demo-user')||'null'); }catch(e){}
                const card = document.getElementById('sitter-onboarding-reminder');
                if(!card) return;
                const isSitter = user && user.role==='sitter';
                const needs = isSitter && user.isOnboarded!==true;
                card.style.display = needs ? 'block' : 'none';
            };
            window.addEventListener('load', updateReminder);
            document.addEventListener('DOMContentLoaded', updateReminder);
            try{ window.__refreshSitterReminder = updateReminder; }catch(e){}
        })();

        function resumeSitterOnboarding(){
            // Resume at first sitter step for now; could detect last incomplete later
            showScreenById('screen-10');
        }

        function sitterEditAvailability(){ alert('⏰ Availability: Update your availability quickly.'); }

        }

        function sendMessage() {
            alert('💬 Message sent to Emma Johnson!\n\n"Hi Emma, looking forward to our booking tonight. See you at 7 PM!"');
        }

        function viewBookings() {
            alert('📅 Your Bookings:\n\n✅ Tonight: Emma Johnson (7-11 PM)\n📅 Saturday: Sarah Wilson (2-6 PM)\n📅 Next Week: 2 pending requests');
        }

        function viewFavorites() {
            alert('⭐ Your Favorite Sitters:\n\n👩‍🦰 Emma Johnson (4.9★)\n👩‍💼 Sarah Wilson (4.8★)\n👩‍🎓 Lisa Chen (4.9★)\n👩‍⚕️ Maria Garcia (5.0★)');
        }

        function viewMessages() {
            alert('💬 Recent Messages:\n\n👩‍🦰 Emma: "Looking forward to tonight!"\n👩‍💼 Sarah: "Available this weekend"\n📱 2 unread messages');
        }

        function selectTimeSlot(time) {
            alert(`⏰ Selected time: ${time}\n\nGreat choice! This time slot is available with Emma Johnson.`);
        }

        function applyPromoCode() {
            const promoInput = document.querySelector('input[placeholder="Enter promo code"]');
            const code = promoInput.value.toUpperCase();

            if (!code) {
                alert('📝 Please enter a promo code');
                return;
            }

            if (code === 'FIRST20' || code === 'WELCOME') {
                alert('🎉 Promo code applied!\n\n💰 20% discount: -$20.00\n💳 New total: $80.00');
                promoInput.value = '';
            } else {
                alert('❌ Invalid promo code\n\nTry: FIRST20 or WELCOME');
            }
        }

        // Social login functions
        function handleGoogleLogin() {
            alert('🔍 Google Login\n\nRedirecting to Google authentication...\n\n(This would normally open Google\'s login page)');
            setTimeout(() => {
                alert('✅ Google login successful!\nWelcome back to NannyRadar! 🎉');
                showScreen(2); // Go to dashboard
            }, 1500);
        }

        function handleFacebookLogin() {
            alert('📘 Facebook Login\n\nRedirecting to Facebook authentication...\n\n(This would normally open Facebook\'s login page)');
            setTimeout(() => {
                alert('✅ Facebook login successful!\nWelcome back to NannyRadar! 🎉');
                showScreen(2); // Go to dashboard
            }, 1500);
        }

        function handleAppleLogin() {
            alert('🍎 Apple Login\n\nRedirecting to Apple ID authentication...\n\n(This would normally use Apple\'s Sign in with Apple)');
            setTimeout(() => {
                alert('✅ Apple login successful!\nWelcome back to NannyRadar! 🎉');
                showScreen(2); // Go to dashboard
            }, 1500);
        }

        function handleSignUp() {
            alert('📝 Sign Up\n\nThis would open the registration form where you can:\n\n• Create a new account\n• Choose Parent or Sitter role\n• Verify your email\n• Set up your profile');
        }

        // Touch/swipe support for mobile
        let startX = 0;
        let startY = 0;

        document.addEventListener('touchstart', function(e) {
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
        }, { passive: true });

        document.addEventListener('touchend', function(e) {
            if (!startX || !startY) return;

            let endX = e.changedTouches[0].clientX;
            let endY = e.changedTouches[0].clientY;

            let diffX = startX - endX;
            let diffY = startY - endY;

        // Client config for backend flip
        const NR_Config = { useServer: true, serverBaseUrl: 'http://localhost:4000', wsUrl: 'ws://localhost:4000/ws', graceSec: 15 };

        // Server helpers for backend mode
        async function api(path, opts){
            const base = NR_Config.serverBaseUrl;
            const res = await fetch(base + path, { headers: { 'Content-Type': 'application/json' }, ...opts });
            if(!res.ok) throw new Error('API ' + res.status);
            return res.json();
        }
        function openWS(sessionId, token){
            try{
                const ws = new WebSocket(NR_Config.wsUrl);
                ws.onopen = () => ws.send(JSON.stringify({ action:'subscribe', sessionId, token }));
                ws.onmessage = (ev) => {
                    try{
                        const msg = JSON.parse(ev.data);
                        if(msg.type==='error' && msg.error==='unauthorized'){ NR_UI.toast('WS unauthorized', 'error'); return; }
                        if(msg.type==='check-in') NR_UI.toast('WS: Check-in', 'success');
                        if(msg.type==='missed') NR_UI.toast('WS: Missed', 'error');
                        if(msg.type==='start' || msg.type==='stop' || msg.type==='share_update' || msg.type==='geo_update') NR_SessionDrawer.render();
                    }catch(_){ }
                };
                return ws;
            }catch(e){ return null; }
        }
            // Only trigger if horizontal swipe is greater than vertical
            if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
                if (diffX > 0) {
                    nextScreen(); // Swipe left = next screen
                } else {
                    prevScreen(); // Swipe right = previous screen
                }
            }

            startX = 0;
            startY = 0;
        }, { passive: true });

        // Prevent zoom on double tap
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();

        // Theme toggle
        (function(){
            const root = document.documentElement;
            const toggle = null;
            function applyTheme(mode){
                if(mode === 'dark'){
                    root.setAttribute('data-theme','dark');
                    toggle.textContent = '☀️';
                } else {
                    root.removeAttribute('data-theme');
                    toggle.textContent = '🌙';
                }
                try{ localStorage.setItem('nr-theme', mode); }catch(e){}
            }
            let saved = null;
            try{ saved = localStorage.getItem('nr-theme'); }catch(e){}
            if(saved){ applyTheme(saved); }
            toggle?.addEventListener('click', ()=>{
                const isDark = root.getAttribute('data-theme') === 'dark';
                applyTheme(isDark ? 'light' : 'dark');
            });
        })();

        // Settings: theme helpers + extra toggle on home
        function setTheme(mode){
            const root = document.documentElement;
            const toggles = [];
            const apply = (m)=>{
                if(m==='auto'){
                    const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                    m = prefersDark ? 'dark' : 'light';
                }
                if(m==='dark'){ root.setAttribute('data-theme','dark'); toggles.forEach(t=>t.textContent='☀️'); }
                else { root.removeAttribute('data-theme'); toggles.forEach(t=>t.textContent='🌙'); }
                try{ localStorage.setItem('nr-theme', m); }catch(e){}
            };
            apply(mode);
        }
        // Wire up second toggle
        (function(){

        })();


            if (now - lastTouchEnd <= 300) {
                // Only prevent zoom if the target is the BODY/HTML, not on a button


                const tag = (event.target && event.target.tagName) ? event.target.tagName.toLowerCase() : '';
                if (tag === 'body' || tag === 'html') {
                    event.preventDefault();

        // Onboarding logic
        function selectRole(role) {
            try {
                const user = JSON.parse(localStorage.getItem('nr-demo-user')||'{}');
                user.role = role;
                localStorage.setItem('nr-demo-user', JSON.stringify(user));
            } catch(e) {}
            // Configure next screen fields by role
            const title = document.getElementById('onboard-title');
            const parentFields = document.getElementById('parent-fields');
            const sitterFields = document.getElementById('sitter-fields');
            if (role === 'parent') {
                if (title) title.textContent = 'Tell us about your family';
                if (parentFields) parentFields.style.display = 'block';
                if (sitterFields) sitterFields.style.display = 'none';
            } else {
                if (title) title.textContent = 'Tell us about your sitter profile';
                if (parentFields) parentFields.style.display = 'none';
                if (sitterFields) sitterFields.style.display = 'block';
            }
            showScreenById('screen-9');
        }

        function completeOnboarding() {
            try {
                const user = JSON.parse(localStorage.getItem('nr-demo-user')||'{}');
                if (user.role === 'parent') {
                    user.childrenCount = (document.getElementById('children-count')||{}).value || '';
                    user.city = (document.getElementById('parent-city')||{}).value || '';
                } else if (user.role === 'sitter') {
                    user.experience = (document.getElementById('sitter-experience')||{}).value || '';
                    user.rate = (document.getElementById('sitter-rate')||{}).value || '';
                }
                user.isOnboarded = true;
                localStorage.setItem('nr-demo-user', JSON.stringify(user));
            } catch(e) {}
            alert('🎉 Onboarding complete!');
            showScreenById('screen-2'); // Go to dashboard after onboarding
        }
                }
            }
            lastTouchEnd = now;
        }, false);

        // Disable keyboard nav that could shift pages during testing
        document.addEventListener('keydown', function(e) {
            const keysToBlock = ['ArrowLeft','ArrowRight'];
            if (keysToBlock.includes(e.key)) {
                e.preventDefault();
                e.stopPropagation();
            }
        }, true);

        // UI Toast utility with ARIA live region
        const NR_UI = (function(){
            let el = null;
            function ensure(){
                if(el) return el;
                el = document.createElement('div');
                el.id = 'nr-toast';
                el.setAttribute('role','status');
                el.setAttribute('aria-live','polite');
                Object.assign(el.style, {
                    position:'fixed', left:'50%', transform:'translateX(-50%)', bottom:'20px',
                    maxWidth:'90%', zIndex:'9999', background:'#2C3E50', color:'#fff',
                    padding:'12px 16px', borderRadius:'12px', boxShadow:'0 8px 20px rgba(0,0,0,0.2)',
                    fontWeight:'600', display:'none'
                });
                document.body.appendChild(el);
                return el;
            }
            function toast(msg, type){
                const n = ensure();
                n.textContent = msg;
                n.style.background = type==='success' ? '#27AE60' : type==='warning' ? '#E67E22' : type==='error' ? '#E74C3C' : '#2C3E50';

                n.style.display = 'block';
                clearTimeout(n._t);
                n._t = setTimeout(()=>{ n.style.display='none'; }, 3000);
            }
            return { toast };
        })();

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            // Start on the landing page
            currentScreen = 0;

            function setCountdown(){
                const el = document.getElementById('checkin-countdown'); if(!el) return;
                const s = load(); if(!s || s.status!=='active'){ el.textContent = 'Next check-in: —'; return; }
                const interval = s.checkInIntervalSec || DEFAULT_INTERVAL_SEC;
                const since = Math.floor((Date.now() - (s.lastCheckInAt||s.startedAt)) / 1000);
                const remain = Math.max(0, interval - since);
                const mm = String(Math.floor(remain/60)).padStart(2,'0');
                const ss = String(remain%60).padStart(2,'0');
                el.textContent = `Next check-in: ${mm}:${ss}`;
            }
            // drive countdown every second
            setInterval(setCountdown, 1000);

            showScreen(0);

            // Ensure landing buttons always work (fallback listener that doesn’t double-fire)
            const btnGetStarted = document.getElementById('btnGetStarted');

        // StackPilotAI: Live Check-In Alerts (demo implementation)
        const NR_CheckIn = (function(){
            const LS_KEY = 'nr-demo-session';
            const DEFAULT_INTERVAL_SEC = 60; // demo: 60s
            let monitorTimer = null;
            function load(){ try{ return JSON.parse(localStorage.getItem(LS_KEY)||'null'); }catch(_){ return null; }}
            function save(s){ try{ localStorage.setItem(LS_KEY, JSON.stringify(s)); }catch(_){} }
            function setBadge(status){
                const badge = document.getElementById('checkin-status-badge');
                if(!badge) return;
                if(status==='missed'){
                    badge.textContent = 'Status: Missed Check-In';
                    badge.style.background = '#E74C3C';
                } else if(status==='ontrack'){
                    badge.textContent = 'Status: On Track';
                    badge.style.background = '#27AE60';
                } else {
                    badge.textContent = 'Status: Idle';
                    badge.style.background = '#7F8C8D';
                }
            }
            function toast(msg, type){ try{ NR_UI.toast(msg, type); }catch(_){ try{ alert(msg); }catch(_){} } }
            function startMonitor(){
                if(monitorTimer) clearInterval(monitorTimer);
                monitorTimer = setInterval(()=>{
                    const s = load();
                    if(!s || s.status!=='active') return;
                    const now = Date.now();
                    const elapsed = (now - (s.lastCheckInAt||s.startedAt)) / 1000;
                    if(elapsed > (s.checkInIntervalSec||DEFAULT_INTERVAL_SEC)){
                        // grace: allow 15s over interval before marking missed
                        const grace = 15;
                        if(elapsed > ((s.checkInIntervalSec||DEFAULT_INTERVAL_SEC) + grace)){
                            s.status = 'missed';
                            save(s);
                            setBadge('missed');
                            toast('⚠️ Missed check-in! Parent alerted and red status shown.', 'error');
                        }
                    }
                }, 1000);
            }
            async function startSession(){
                // read desired interval from select if present
                const sel = document.getElementById('checkin-interval');
                const interval = sel ? parseInt(sel.value, 10) : DEFAULT_INTERVAL_SEC;
                if(NR_Config.useServer){
                    try{
                        const res = await api('/api/sessions/start', { method:'POST', body: JSON.stringify({ intervalSec: interval, graceSec: (NR_Config.graceSec!=null?NR_Config.graceSec:15) }) });
                        const session = {
                            id: res.sessionId,
                            sitterId: 'sitter-1', parentId: 'parent-1',
                            startedAt: res.startedAt, lastCheckInAt: res.startedAt,
                            checkInIntervalSec: res.intervalSec, status: 'active'
                        };
                        save(session);
                        if(window.NR_Socket) try{ window.NR_Socket.close(); }catch(_){ }
                        window.NR_Socket = openWS(session.id, res.token);
                    }catch(e){ NR_UI.toast('Server start failed; using demo', 'warning'); NR_Config.useServer=false; return startSession(); }
                } else {
                    const session = {
                        id: 'demo-1',
                        sitterId: 'sitter-1',
                        parentId: 'parent-1',
                        startedAt: Date.now(),
                        lastCheckInAt: Date.now(),
                        checkInIntervalSec: isFinite(interval) && interval > 0 ? interval : DEFAULT_INTERVAL_SEC,
                        status: 'active'
                    };
                    save(session);
                }
                setBadge('ontrack');
                startMonitor();
                updateEndBookingVisibility();
                setCountdown();
                toast(`🟢 Session started. Check-ins required every ${(load().checkInIntervalSec||DEFAULT_INTERVAL_SEC)/60} min.`, 'success');
            }
            async function stopSession(){
                const s = load();
                if(NR_Config.useServer && s && s.id && s.id!=='demo-1'){
                    try{ await api(`/api/sessions/${s.id}/stop`, { method:'POST' }); }catch(_){ }
                    try{
                        // Auto-generate invoice (MVP)
                        const hours = Math.max(0.25, Math.round(((Date.now() - (s.startedAt||Date.now()))/3600000)*100)/100);
                        const inv = await api(`/api/invoices/generate`, { method:'POST', body: JSON.stringify({ bookingId: s.id, sitterName: 'Emma Johnson', hours, date: new Date().toLocaleDateString(), payment: 100 }) });
                        if(inv && inv.path){ try{ window.open(NR_Config.serverBaseUrl+`/api/invoices/${s.id}`, '_blank'); }catch(_){ NR_UI.toast('Invoice generated', 'success'); }
                        }
                        // Show tip jar for parent
                        NR_TipJar.showTipScreen(s.id, 'sitter-1', 'parent-1');
                    }catch(_){ /* ignore invoice errors */ }
                    try{ if(window.NR_Socket) { window.NR_Socket.close(); window.NR_Socket = null; } }catch(_){ }
                }
                localStorage.removeItem(LS_KEY);
                setBadge('idle');
                if(monitorTimer) clearInterval(monitorTimer);
                monitorTimer = null;
                updateEndBookingVisibility();
                setCountdown();
                toast('⏹️ Session stopped.', 'warning');
            }
            return {
                toggleSession(){ const s=load(); if(s && s.status==='active') stopSession(); else startSession(); },
                startSession, // exposed for auto-start after booking confirmation
                stopSession,  // exposed for ending booking/session
                async sendCheckIn(){
                    const s = load();
                    if(!s){ toast('No active session. Start session first.'); return; }
                    if(NR_Config.useServer && s.id && s.id!=='demo-1'){
                        try{
                            const res = await api(`/api/sessions/${s.id}/check-in`, { method:'POST' });
                            s.lastCheckInAt = res.lastCheckInAt || Date.now();
                            // Re-subscribe WS with rotated token
                            try{ if(window.NR_Socket) { window.NR_Socket.close(); } }catch(_){ }
                            window.NR_Socket = openWS(s.id, res.token);
                        }catch(e){ NR_UI.toast('Server check-in failed; using local', 'warning'); s.lastCheckInAt = Date.now(); NR_Config.useServer=false; }
                    } else {
                        s.lastCheckInAt = Date.now();
                    }
                    s.status = 'active';
                    save(s);
                    setBadge('ontrack');
                    toast('✅ Check-in sent.', 'success');
                },
                updateIntervalFromSelect(){
                    const s = load();
                    const sel = document.getElementById('checkin-interval');
                    if(!sel) return;
                    const v = parseInt(sel.value,10);
                    if(s && s.status==='active'){
                        s.checkInIntervalSec = isFinite(v) && v>0 ? v : s.checkInIntervalSec;
                        save(s);
                        toast(`⏱️ Interval updated to ${s.checkInIntervalSec/60} min.`);
                    }


        // FrontForceAI: Trusted Circle (prototype)
        const NR_Trusted = (function(){
            const LS_CONTACTS = 'nr-trusted-contacts';
            const LS_SHARED = 'nr-trusted-shared';
            function loadK(k){ try{ return JSON.parse(localStorage.getItem(k)||'null'); }catch(_){ return null; } }
            function saveK(k,v){ try{ localStorage.setItem(k, JSON.stringify(v)); }catch(_){} }
            function getContacts(){ return Array.isArray(loadK(LS_CONTACTS)) ? loadK(LS_CONTACTS) : []; }
            function setContacts(arr){ saveK(LS_CONTACTS, arr); renderList(); syncSharedCount(); }
            function getShared(){ return Array.isArray(loadK(LS_SHARED)) ? loadK(LS_SHARED) : []; }
            function setShared(arr){ saveK(LS_SHARED, arr); syncSharedCount(); }
            function renderList(){
                const list = document.getElementById('trusted-list'); if(!list) return;
                const items = getContacts();
                list.innerHTML = '';
                if(items.length===0){ list.innerHTML = '<div style="color:#7F8C8D;">No trusted contacts yet.</div>'; return; }
                items.forEach((c, idx)=>{
                    const row = document.createElement('div');
                    row.style.display='flex'; row.style.alignItems='center'; row.style.justifyContent='space-between'; row.style.gap='8px';
                    row.innerHTML = `<div><div style="font-weight:600; color:#2C3E50;">${c.name||'Untitled'}</div><div style="font-size:0.9rem; color:#7F8C8D;">${c.contact||''}</div></div>`;
                    const right = document.createElement('div'); right.style.display='flex'; right.style.gap='6px';
                    const notify = document.createElement('input'); notify.type='checkbox'; notify.checked=!!c.notify; notify.title='Notify on alerts';
                    notify.onchange = ()=>{ c.notify = notify.checked; const arr=getContacts(); arr[idx]=c; setContacts(arr); };
                    const viewonly = document.createElement('input'); viewonly.type='checkbox'; viewonly.checked=!!c.viewonly; viewonly.title='View-only';
                    viewonly.onchange = ()=>{ c.viewonly = viewonly.checked; const arr=getContacts(); arr[idx]=c; setContacts(arr); };
                    const remove = document.createElement('button'); remove.className='btn'; remove.style.background='#EEE'; remove.textContent='Remove';
                    remove.onclick=()=>{ const arr=getContacts(); arr.splice(idx,1); setContacts(arr); };
                    right.append(notify, viewonly, remove);
                    row.appendChild(right);
                    list.appendChild(row);
                });
            }
            function openContactsModal(){ const m=document.getElementById('modal-trusted'); if(m){ m.style.display='flex'; renderList(); } }
            function closeContactsModal(){ const m=document.getElementById('modal-trusted'); if(m){ m.style.display='none'; } }
            function addContact(){
                const name = (document.getElementById('trusted-name')||{}).value||'';
                const contact = (document.getElementById('trusted-contact')||{}).value||'';
                const notify = (document.getElementById('trusted-notify')||{}).checked||false;
                const viewonly = (document.getElementById('trusted-viewonly')||{}).checked||true;
                if(!name || !contact){ NR_UI.toast('Enter name and contact', 'warning'); return; }
                const arr = getContacts(); arr.push({name, contact, notify, viewonly}); setContacts(arr);
                (document.getElementById('trusted-name')||{}).value=''; (document.getElementById('trusted-contact')||{}).value='';
                NR_UI.toast('Contact added', 'success');
            }
            function clearContacts(){ setContacts([]); NR_UI.toast('All contacts cleared', 'warning'); }
            function syncSharedCount(){
                const countEl = document.getElementById('trusted-shared-count');
                const viewersEl = document.getElementById('trusted-viewers');
                const shared = getShared();
                if(countEl) countEl.textContent = `Shared with ${shared.length}`;
                if(viewersEl){
                    if(!shared.length) viewersEl.textContent = 'Shared with: none';
                    else viewersEl.textContent = 'Shared with: ' + shared.map(s=>s.contact).join(', ');
                }
            }
            function onShareToggle(on){
                const toggle = document.getElementById('trusted-share-toggle');
                if(toggle) toggle.checked = !!on;
                if(on){
                    const contacts = getContacts();
                    setShared(contacts.map((c,i)=>({ id: i+1, contact: c.contact })));
                    NR_UI.toast(`Session shared with ${contacts.length} contacts`, 'success');
                } else {
                    setShared([]);
                    NR_UI.toast('Session unshared', 'warning');
                }
            }
            // Persist share toggle across refresh
            // Basic validation and focus trapping for modal
            function isValidContact(v){
                const email=/^[^@\s]+@[^@\s]+\.[^@\s]+$/; const phone=/^[0-9\-\+\s\(\)]{7,}$/;
                return email.test(v) || phone.test(v);

        // SnapBuilderAI: Geo-Fencing Alerts (prototype)
        const NR_Geo = (function(){
            const LS_GEO = 'nr-geo-settings';
            const state = { watchId: null, enabled: false, radius: 100, center: null };
            function load(){ try{ return JSON.parse(localStorage.getItem(LS_GEO)||'null'); }catch(_){ return null; } }
            function save(v){ try{ localStorage.setItem(LS_GEO, JSON.stringify(v)); }catch(_){ } }
            function getSession(){ try{ return JSON.parse(localStorage.getItem('nr-demo-session')||'null'); }catch(_){ return null; } }
            function setGeoStatus(msg){ const el=document.getElementById('geo-status'); if(el) el.textContent = 'Location: ' + msg; }
            function distanceMeters(a, b){
                const toRad = d=>d*Math.PI/180; const R=6371000;
                const dLat=toRad(b.lat-a.lat); const dLon=toRad(b.lon-a.lon);
                const lat1=toRad(a.lat), lat2=toRad(b.lat);
                const x = Math.sin(dLat/2)**2 + Math.cos(lat1)*Math.cos(lat2)*Math.sin(dLon/2)**2;
                return 2*R*Math.asin(Math.sqrt(x));
            }
            function simulateCenter(){
                // Use a fixed mock booking coordinate
                return { lat: 40.7128, lon: -74.0060 }; // NYC
            }
            function getCenter(){
                if(state.center) return state.center;
                const s = getSession();
                // For prototype, use simulateCenter; later: use booking address -> geocode
                state.center = simulateCenter();
                return state.center;
            }
            function handlePosition(pos){
                const center = getCenter();
                const cur = { lat: pos.coords.latitude, lon: pos.coords.longitude };
                const d = distanceMeters(center, cur);
                const radius = state.radius;
                const inside = d <= radius;
                setGeoStatus(inside ? `Inside (${Math.round(d)}m)` : `Outside (${Math.round(d)}m)`);
                if(!inside){
                    // Alert parent + notify trusted viewers
                    NR_UI.toast(`🚧 Geo-fence breached (${Math.round(d)}m).`, 'error');
                    try{
                        const shared = JSON.parse(localStorage.getItem('nr-trusted-shared')||'[]');
                        if(shared && shared.length){ NR_UI.toast(`📣 Notified: ${shared.map(s=>s.contact).join(', ')}`, 'error'); }
                    }catch(_){ }
                }
            }
            function handleError(err){ setGeoStatus('Error or denied'); }
            function start(){
                if(state.watchId) return; // already running
                const s = getSession(); if(!s || s.status!=='active'){ NR_UI.toast('Start a session to enable geo-fence', 'warning'); return; }
                state.enabled = true; save({ enabled:true, radius: state.radius });
                const w = navigator.geolocation && navigator.geolocation.watchPosition ?
                    navigator.geolocation.watchPosition(handlePosition, handleError, { enableHighAccuracy:true, maximumAge:3000, timeout:10000 }) : null;
                if(w==null){
                    // Fallback: simulate movement around center
                    const center=getCenter(); let angle=0;
                    state.watchId = setInterval(()=>{
                        angle += 0.05; const r=0.0005; // ~55m radius
                        const pos = { coords:{ latitude:center.lat + Math.sin(angle)*r, longitude:center.lon + Math.cos(angle)*r } };
                        handlePosition(pos);
                    }, 2000);
                } else {
                    state.watchId = w;
                }
                const toggle = document.getElementById('geo-toggle'); if(toggle) toggle.checked = true;
            }
            function stop(){
                state.enabled = false; save({ enabled:false, radius: state.radius });
                if(state.watchId){
                    if(typeof state.watchId === 'number') clearInterval(state.watchId);
                    else if(navigator.geolocation && navigator.geolocation.clearWatch) navigator.geolocation.clearWatch(state.watchId);
                }
                state.watchId = null; setGeoStatus('—');
                const toggle = document.getElementById('geo-toggle'); if(toggle) toggle.checked = false;
            }
            function onGeoToggle(on){ if(on) start(); else stop(); }
            function onRadiusChange(v){ state.radius = parseInt(v,10)||100; save({ enabled: state.enabled, radius: state.radius }); }
            function restore(){ const s=load(); if(s){ state.radius = s.radius||100; const sel=document.getElementById('geo-radius'); if(sel) sel.value=String(state.radius); if(s.enabled) start(); else stop(); } else { stop(); } }
            function openCenterModal(){ const m=document.getElementById('modal-geo-center'); if(m){ m.style.display='flex'; const c=getCenter(); const lat=document.getElementById('geo-lat'); const lon=document.getElementById('geo-lon'); if(lat) lat.value=c.lat; if(lon) lon.value=c.lon; } }
            function closeCenterModal(){ const m=document.getElementById('modal-geo-center'); if(m){ m.style.display='none'; } }
            function useCurrentLocation(){ if(!navigator.geolocation){ NR_UI.toast('Location not available', 'warning'); return; } navigator.geolocation.getCurrentPosition(p=>{ const lat=document.getElementById('geo-lat'); const lon=document.getElementById('geo-lon'); if(lat) lat.value=p.coords.latitude.toFixed(6); if(lon) lon.value=p.coords.longitude.toFixed(6); }, _=>NR_UI.toast('Permission denied', 'warning')); }
            function saveCenter(){ const latEl=document.getElementById('geo-lat'); const lonEl=document.getElementById('geo-lon'); const lat=parseFloat(latEl&&latEl.value); const lon=parseFloat(lonEl&&lonEl.value); if(!isFinite(lat)||!isFinite(lon)){ NR_UI.toast('Enter valid coordinates', 'warning'); return; } state.center = { lat, lon }; NR_UI.toast('Geo center saved', 'success'); closeCenterModal(); }
            return { onGeoToggle, onRadiusChange, restore, openCenterModal, closeCenterModal, useCurrentLocation, saveCenter };
        })();
        // Restore geo settings on load
        document.addEventListener('DOMContentLoaded', ()=>{ try{ NR_Geo.restore(); }catch(_){} });
            }
            // override addContact to validate and focus
            const _addContact = addContact;
            addContact = function(){
                const nameEl = document.getElementById('trusted-name');
                const contactEl = document.getElementById('trusted-contact');
                const name = (nameEl||{}).value||'';
                const contact = (contactEl||{}).value||'';
                if(!name){ NR_UI.toast('Enter name', 'warning'); if(nameEl) nameEl.focus(); return; }
                if(!isValidContact(contact)){ NR_UI.toast('Enter a valid email or phone', 'warning'); if(contactEl) contactEl.focus(); return; }
                _addContact();
                if(nameEl) nameEl.focus();
            }
            function trapFocusOpen(modal){
                const focusable = modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
                if(!focusable.length) return;
                const first = focusable[0]; const last = focusable[focusable.length-1];
                function handle(e){
                    if(e.key==='Tab'){
                        if(e.shiftKey && document.activeElement===first){ e.preventDefault(); last.focus(); }
                        else if(!e.shiftKey && document.activeElement===last){ e.preventDefault(); first.focus(); }
                    }
                    if(e.key==='Escape'){ closeContactsModal(); }
                }
                modal.__trapHandler = handle; modal.addEventListener('keydown', handle);
                first.focus();
            }
            function trapFocusClose(modal){ if(modal && modal.__trapHandler){ modal.removeEventListener('keydown', modal.__trapHandler); modal.__trapHandler=null; } }
            const _open = openContactsModal; openContactsModal = function(){ _open(); const m=document.getElementById('modal-trusted'); if(m) trapFocusOpen(m); };
            const _close = closeContactsModal; closeContactsModal = function(){ const m=document.getElementById('modal-trusted'); if(m) trapFocusClose(m); _close(); };

            (function(){
                try{
                    const shared = getShared();
                    const isOn = shared && shared.length > 0;
                    const toggle = document.getElementById('trusted-share-toggle');
        // Feature 4: Secure Video Snapshot Verification
        const NR_Verify = (function(){
            async function captureArrival(){
                try{
                    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                    const video = document.createElement('video');
                    video.srcObject = stream;
                    video.play();

                    // Simple capture UI
                    const modal = document.createElement('div');
                    modal.style.cssText = 'position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:999; display:flex; flex-direction:column; align-items:center; justify-content:center;';
                    modal.innerHTML = `
                        <div style="color:white; margin-bottom:20px; text-align:center;">
                            <h3>📸 Verify Your Arrival</h3>
                            <p>Position yourself in the camera and tap capture</p>
                        </div>
                        <div style="position:relative;">
                            <video id="verify-video" width="300" height="200" autoplay style="border-radius:10px;"></video>
                            <canvas id="verify-canvas" width="300" height="200" style="display:none;"></canvas>
                        </div>
                        <div style="margin-top:20px; display:flex; gap:15px;">
                            <button class="btn" style="background:#4CAF50; color:white;" onclick="NR_Verify.capture()">📸 Capture</button>
                            <button class="btn" style="background:#f44336; color:white;" onclick="NR_Verify.closeCapture()">Cancel</button>
                        </div>
                    `;
                    document.body.appendChild(modal);
                    const modalVideo = modal.querySelector('#verify-video');
                    modalVideo.srcObject = stream;
                    window.NR_VerifyModal = modal;
                    window.NR_VerifyStream = stream;
                }catch(e){
                    NR_UI.toast('Camera access denied or unavailable', 'error');
                }
            }

            function capture(){
                try{
                    const video = document.getElementById('verify-video');
                    const canvas = document.getElementById('verify-canvas');
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(video, 0, 0, 300, 200);
                    canvas.toBlob(async (blob) => {
                        try{
                            const sitterId = 'sitter-1'; // In real app, get from session
                            const res = await fetch(NR_Config.serverBaseUrl + `/api/verify/arrival?sitterId=${sitterId}`, {
                                method: 'POST', body: blob, headers: { 'Content-Type': 'image/jpeg' }
                            });
                            const result = await res.json();
                            if(result.verified){
                                NR_UI.toast(`✅ Arrival verified! (${Math.round(result.score*100)}% match)`, 'success');
                            } else {
                                NR_UI.toast(`❌ Verification failed (${Math.round(result.score*100)}% match)`, 'error');
                            }
                        }catch(e){
                            NR_UI.toast('Verification failed - server error', 'error');
                        }
                        closeCapture();
                    }, 'image/jpeg', 0.8);
                }catch(e){
                    NR_UI.toast('Capture failed', 'error');
                }
            }

            function closeCapture(){
                if(window.NR_VerifyStream){
                    window.NR_VerifyStream.getTracks().forEach(track => track.stop());
                    window.NR_VerifyStream = null;
                }
                if(window.NR_VerifyModal){
                    document.body.removeChild(window.NR_VerifyModal);
                    window.NR_VerifyModal = null;
                }
            }

            return { captureArrival, capture, closeCapture };
        })();

        // Feature 5: Panic Button + Emergency Dispatch
        const NR_Emergency = (function(){
            function triggerPanic(){
                const contacts = NR_Trusted.getContacts ? NR_Trusted.getContacts() : [];
                if(!contacts.length){
                    NR_UI.toast('No emergency contacts set. Add contacts in Trusted Circle first.', 'warning');
                    return;
                }

                // Get current location if available
                const getLocation = () => new Promise((resolve) => {
                    if(!navigator.geolocation) resolve(null);
                    navigator.geolocation.getCurrentPosition(
                        pos => resolve({ lat: pos.coords.latitude, lon: pos.coords.longitude }),
                        () => resolve(null),
                        { timeout: 5000 }
                    );
                });

                const modal = document.createElement('div');
                modal.style.cssText = 'position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:999; display:flex; flex-direction:column; align-items:center; justify-content:center; color:white; text-align:center;';
                modal.innerHTML = `
                    <div style="background:#f44336; padding:30px; border-radius:15px; max-width:300px;">
                        <h2>🚨 EMERGENCY ALERT</h2>
                        <p>This will immediately notify your emergency contacts:</p>
                        <div style="margin:15px 0; font-size:0.9rem;">
                            ${contacts.map(c => `• ${c.name} (${c.contact})`).join('<br>')}
                        </div>

                        <textarea id="emergency-message" placeholder="Optional message..." style="width:100%; height:60px; margin:10px 0; padding:8px; border-radius:5px; border:none;"></textarea>
                        <div style="display:flex; gap:10px; margin-top:15px;">
                            <button class="btn" style="background:#d32f2f; color:white; flex:1;" onclick="NR_Emergency.sendAlert()">🚨 SEND ALERT</button>
                            <button class="btn" style="background:#666; color:white;" onclick="NR_Emergency.cancelPanic()">Cancel</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
                window.NR_PanicModal = modal;
            }

            async function sendAlert(){
                try{
                    const contacts = NR_Trusted.getContacts ? NR_Trusted.getContacts() : [];
                    const message = document.getElementById('emergency-message')?.value || 'Emergency assistance needed';
                    const session = JSON.parse(localStorage.getItem('nr-demo-session') || 'null');

                    // Get location
                    const location = await new Promise((resolve) => {
                        if(!navigator.geolocation) resolve(null);
                        navigator.geolocation.getCurrentPosition(
                            pos => resolve({ lat: pos.coords.latitude, lon: pos.coords.longitude }),
                            () => resolve(null),
                            { timeout: 3000 }
                        );
                    });

                    const payload = {
                        sessionId: session?.id || 'demo-session',
                        contacts: contacts.map(c => c.contact),
                        message,
                        location
                    };

                    await fetch(NR_Config.serverBaseUrl + '/api/emergency/trigger', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    NR_UI.toast(`🚨 Emergency alert sent to ${contacts.length} contacts`, 'error');
                    cancelPanic();
                }catch(e){
                    NR_UI.toast('Failed to send emergency alert', 'error');
                }
            }

            function cancelPanic(){
                if(window.NR_PanicModal){
                    document.body.removeChild(window.NR_PanicModal);
                    window.NR_PanicModal = null;
                }
            }

            return { triggerPanic, sendAlert, cancelPanic };
        })();
                    if(toggle) toggle.checked = isOn;
                    syncSharedCount();
                }catch(_){ }
            })();
            return { openContactsModal, closeContactsModal, addContact, clearContacts, onShareToggle };
        })();

        // Session Drawer controller
        const NR_SessionDrawer = (function(){
            const LS_EVENTS = 'nr-session-events';
            function loadSession(){ try{ return JSON.parse(localStorage.getItem('nr-demo-session')||'null'); }catch(_){ return null; } }
            function loadShared(){ try{ return JSON.parse(localStorage.getItem('nr-trusted-shared')||'[]'); }catch(_){ return []; } }
            function loadGeo(){ try{ return JSON.parse(localStorage.getItem('nr-geo-settings')||'null'); }catch(_){ return null; } }
            function loadEvents(){ try{ return JSON.parse(localStorage.getItem(LS_EVENTS)||'[]'); }catch(_){ return []; } }
            function saveEvents(arr){ try{ localStorage.setItem(LS_EVENTS, JSON.stringify(arr)); }catch(_){} }
            function addEvent(type, msg){
                const arr = loadEvents();
                const ts = new Date().toLocaleTimeString();
                arr.unshift({ ts, type, msg });
                saveEvents(arr.slice(0,50));
                render();
            }
            function formatInterval(sec){ const m=Math.floor(sec/60); return `${m} min`; }
            function formatCountdown(){ const el=document.getElementById('checkin-countdown'); return el? el.textContent.replace('Next check-in: ','') : '—'; }
            async function render(){
                const s = loadSession();
                document.getElementById('sd-interval').textContent = s? formatInterval(s.checkInIntervalSec||60) : '—';
                document.getElementById('sd-countdown').textContent = formatCountdown();
                document.getElementById('sd-last').textContent = s? (new Date(s.lastCheckInAt||s.startedAt)).toLocaleTimeString() : '—';
                const geo = loadGeo();
                const center = (window.NR_Geo && NR_Geo.getCenter) ? NR_Geo.getCenter() : null;
                const geoTxt = geo ? `${geo.radius||100}m @ ${center? center.lat.toFixed(4)+','+center.lon.toFixed(4) : 'set'}` : '—';
                document.getElementById('sd-geo').textContent = geoTxt;
        // Features 7-10: Tip Jar, Cancellation, Smart Pricing, Apple Pay
        const NR_TipJar = (function(){
            function showTipScreen(sessionId, sitterId, parentId){
                const modal = document.createElement('div');
                modal.style.cssText = 'position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:999; display:flex; align-items:center; justify-content:center;';
                modal.innerHTML = '<div style="background:white; padding:30px; border-radius:15px; max-width:350px; text-align:center;"><h2 style="color:#FF69B4; margin-bottom:20px;">💝 Tip Your Sitter</h2><p style="margin-bottom:20px; color:#666;">Show appreciation for great care!</p><div style="display:flex; gap:10px; margin-bottom:20px;"><button class="tip-btn" data-amount="5" style="flex:1; padding:15px; border:2px solid #FF69B4; background:white; color:#FF69B4; border-radius:8px; cursor:pointer;">$5</button><button class="tip-btn" data-amount="10" style="flex:1; padding:15px; border:2px solid #FF69B4; background:white; color:#FF69B4; border-radius:8px; cursor:pointer;">$10</button><button class="tip-btn" data-amount="20" style="flex:1; padding:15px; border:2px solid #FF69B4; background:white; color:#FF69B4; border-radius:8px; cursor:pointer;">$20</button></div><div style="margin-bottom:20px;"><input type="number" id="custom-tip" placeholder="Custom amount" min="1" max="500" style="width:100%; padding:12px; border:2px solid #ddd; border-radius:8px; text-align:center;"></div><div style="display:flex; gap:10px;"><button onclick="NR_TipJar.processTip(\''+sessionId+'\',\''+sitterId+'\',\''+parentId+'\')" style="flex:1; background:#FF69B4; color:white; padding:12px; border:none; border-radius:8px; cursor:pointer;">💳 Send Tip</button><button onclick="NR_TipJar.closeTip()" style="background:#ccc; color:#666; padding:12px 20px; border:none; border-radius:8px; cursor:pointer;">Skip</button></div></div>';
                document.body.appendChild(modal);
                window.NR_TipModal = modal;
                modal.querySelectorAll('.tip-btn').forEach(btn => {
                    btn.onclick = () => {
                        modal.querySelectorAll('.tip-btn').forEach(b => b.style.background = 'white');
                        btn.style.background = '#FF69B4'; btn.style.color = 'white';
                        document.getElementById('custom-tip').value = btn.dataset.amount;
                    };
                });
            }
            async function processTip(sessionId, sitterId, parentId){
                const amount = parseFloat(document.getElementById('custom-tip').value);
                if(!amount || amount < 1){ NR_UI.toast('Please select a tip amount', 'warning'); return; }
                try{
                    const res = await api('/api/tips/process', { method:'POST', body: JSON.stringify({ sessionId, sitterId, parentId, amount }) });
                    NR_UI.toast('$'+amount+' tip sent successfully!', 'success');
                    closeTip();
                }catch(e){ NR_UI.toast('Tip processing failed', 'error'); }
            }
            function closeTip(){
                if(window.NR_TipModal){ document.body.removeChild(window.NR_TipModal); window.NR_TipModal = null; }
            }
            return { showTipScreen, processTip, closeTip };
        })();

        const NR_Cancellation = (function(){
            function showCancelModal(bookingId){
                const modal = document.createElement('div');
                modal.style.cssText = 'position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:999; display:flex; align-items:center; justify-content:center;';
                modal.innerHTML = '<div style="background:white; padding:30px; border-radius:15px; max-width:400px;"><h2 style="color:#E74C3C; margin-bottom:20px;">Cancel Booking</h2><p style="margin-bottom:20px; color:#666;">Choose your cancellation policy:</p><div style="margin-bottom:20px;"><label style="display:block; margin-bottom:10px; padding:10px; border:2px solid #ddd; border-radius:8px; cursor:pointer;"><input type="radio" name="policy" value="2hr" style="margin-right:10px;"> 2 Hour Notice (50% refund)</label><label style="display:block; margin-bottom:10px; padding:10px; border:2px solid #ddd; border-radius:8px; cursor:pointer;"><input type="radio" name="policy" value="6hr" style="margin-right:10px;"> 6 Hour Notice (75% refund)</label><label style="display:block; margin-bottom:10px; padding:10px; border:2px solid #ddd; border-radius:8px; cursor:pointer;"><input type="radio" name="policy" value="24hr" style="margin-right:10px;" checked> 24 Hour Notice (90% refund)</label></div><textarea id="cancel-reason" placeholder="Reason for cancellation (optional)" style="width:100%; height:60px; margin-bottom:20px; padding:10px; border:2px solid #ddd; border-radius:8px;"></textarea><div style="display:flex; gap:10px;"><button onclick="NR_Cancellation.processCancel(\''+bookingId+'\')" style="flex:1; background:#E74C3C; color:white; padding:12px; border:none; border-radius:8px; cursor:pointer;">Cancel Booking</button><button onclick="NR_Cancellation.closeCancel()" style="background:#ccc; color:#666; padding:12px 20px; border:none; border-radius:8px; cursor:pointer;">Keep Booking</button></div></div>';
                document.body.appendChild(modal);
                window.NR_CancelModal = modal;
            }
            async function processCancel(bookingId){
                const policy = document.querySelector('input[name="policy"]:checked')?.value;
                const reason = document.getElementById('cancel-reason').value;
                if(!policy){ NR_UI.toast('Please select a cancellation policy', 'warning'); return; }
                try{
                    const res = await api('/api/bookings/'+bookingId+'/cancel', { method:'POST', body: JSON.stringify({ policy, reason }) });
                    NR_UI.toast('Booking cancelled. Refund: $'+res.refundAmount, 'success');
                    closeCancel();
                }catch(e){ NR_UI.toast('Cancellation failed', 'error'); }
            }
            function closeCancel(){
                if(window.NR_CancelModal){ document.body.removeChild(window.NR_CancelModal); window.NR_CancelModal = null; }
            }
            return { showCancelModal, processCancel, closeCancel };
        })();

        const NR_SmartPricing = (function(){
            async function calculatePrice(baseRate, factors){
                try{
                    const res = await api('/api/pricing/calculate', { method:'POST', body: JSON.stringify({ baseRate, factors }) });
                    return res;
                }catch(e){ return { baseRate, smartRate: baseRate, factors, markup: 0 }; }
            }
            function updatePricingDisplay(baseRate){
                const factors = {
                    isHoliday: new Date().getDay() === 0 || new Date().getDay() === 6,
                    isWeekend: new Date().getDay() === 0 || new Date().getDay() === 6,
                    experience: 3, demand: Math.random() > 0.7 ? 'high' : 'normal', location: 'standard'
                };
                calculatePrice(baseRate, factors).then(pricing => {
                    const displays = document.querySelectorAll('.pricing-display');
                    displays.forEach(el => {
                        el.innerHTML = '<div style="font-size:1.2em; font-weight:bold; color:#FF69B4;">$'+pricing.smartRate+'/hr</div><div style="font-size:0.8em; color:#666;">Base: $'+pricing.baseRate+(pricing.markup > 0 ? ' (+$'+pricing.markup.toFixed(2)+')' : '')+'</div>';
                    });
                });
            }
            return { calculatePrice, updatePricingDisplay };
        })();

        const NR_Payments = (function(){
            async function createPaymentIntent(amount, methods = ['card','apple_pay','cashapp']){
                try{
                    const res = await api('/api/payments/create-intent', { method:'POST', body: JSON.stringify({ amount, paymentMethods: methods }) });
                    return res;
                }catch(e){ throw new Error('Payment setup failed'); }
            }
            function showPaymentModal(amount, onSuccess){
                const modal = document.createElement('div');
                modal.style.cssText = 'position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:999; display:flex; align-items:center; justify-content:center;';
                modal.innerHTML = '<div style="background:white; padding:30px; border-radius:15px; max-width:350px; text-align:center;"><h2 style="color:#6C63FF; margin-bottom:20px;">💳 Payment</h2><div style="font-size:1.5em; font-weight:bold; margin-bottom:20px; color:#333;">$'+amount+'</div><div style="display:flex; flex-direction:column; gap:12px; margin-bottom:20px;"><button onclick="NR_Payments.processPayment(\'card\', \''+amount+'\')" style="padding:15px; background:#6C63FF; color:white; border:none; border-radius:8px; cursor:pointer;">💳 Credit Card</button><button onclick="NR_Payments.processPayment(\'apple_pay\', \''+amount+'\')" style="padding:15px; background:#000; color:white; border:none; border-radius:8px; cursor:pointer;">🍎 Apple Pay</button><button onclick="NR_Payments.processPayment(\'cashapp\', \''+amount+'\')" style="padding:15px; background:#00D632; color:white; border:none; border-radius:8px; cursor:pointer;">💚 Cash App Pay</button></div><button onclick="NR_Payments.closePayment()" style="background:#ccc; color:#666; padding:10px 20px; border:none; border-radius:8px; cursor:pointer;">Cancel</button></div>';
                document.body.appendChild(modal);
                window.NR_PaymentModal = modal;
                window.NR_PaymentSuccess = onSuccess;
            }
            async function processPayment(method, amount){
                try{
                    const intent = await createPaymentIntent(parseFloat(amount), [method]);
                    const res = await api('/api/payments/confirm', { method:'POST', body: JSON.stringify({ intentId: intent.intentId, method }) });
                    NR_UI.toast('Payment successful via '+method.replace('_',' ')+'!', 'success');
                    if(window.NR_PaymentSuccess) window.NR_PaymentSuccess(res);
                    closePayment();
                }catch(e){ NR_UI.toast('Payment failed', 'error'); }
            }
            function closePayment(){
                if(window.NR_PaymentModal){ document.body.removeChild(window.NR_PaymentModal); window.NR_PaymentModal = null; }
                window.NR_PaymentSuccess = null;
            }
            return { createPaymentIntent, showPaymentModal, processPayment, closePayment };
        })();
        // Features 11-14: Smart Scheduler, Predictive Rebooking, Trust Score, AI Assistant
        const NR_SmartScheduler = (function(){
            async function getSuggestedTimes(sitterId){
                try{
                    const res = await api('/api/sitters/'+sitterId+'/suggested-times');
                    return res.suggestions || [];
                }catch(e){ return []; }
            }
            function showSchedulerModal(sitterId){
                const modal = document.createElement('div');
                modal.style.cssText = 'position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:999; display:flex; align-items:center; justify-content:center;';
                modal.innerHTML = '<div style="background:white; padding:30px; border-radius:15px; max-width:400px;"><h2 style="color:#6C63FF; margin-bottom:20px;">📅 Smart Scheduler</h2><p style="margin-bottom:20px; color:#666;">AI-suggested optimal booking times:</p><div id="suggested-times" style="margin-bottom:20px;"></div><button onclick="NR_SmartScheduler.closeScheduler()" style="background:#ccc; color:#666; padding:10px 20px; border:none; border-radius:8px; cursor:pointer;">Close</button></div>';
                document.body.appendChild(modal);
                window.NR_SchedulerModal = modal;
                getSuggestedTimes(sitterId).then(suggestions => {
                    const container = document.getElementById('suggested-times');
                    if(suggestions.length){
                        container.innerHTML = suggestions.map(s => '<div style="padding:10px; border:2px solid #6C63FF; border-radius:8px; margin-bottom:10px; cursor:pointer;" onclick="NR_SmartScheduler.selectTime(\''+s.start+'\')"><strong>'+new Date(s.start).toLocaleDateString()+' '+new Date(s.start).toLocaleTimeString()+'</strong><br><small>'+s.reason+' ('+Math.round(s.confidence*100)+'% confidence)</small></div>').join('');
                    } else {
                        container.innerHTML = '<p style="color:#666;">No suggestions available</p>';
                    }
                });
            }
            function selectTime(timeStr){ NR_UI.toast('Time selected: '+new Date(timeStr).toLocaleString(), 'success'); closeScheduler(); }
            function closeScheduler(){ if(window.NR_SchedulerModal){ document.body.removeChild(window.NR_SchedulerModal); window.NR_SchedulerModal = null; } }
            return { getSuggestedTimes, showSchedulerModal, selectTime, closeScheduler };
        })();

        const NR_Rebooking = (function(){
            async function getSuggestions(parentId, sitterId){
                try{
                    const res = await api('/api/rebooking/suggest', { method:'POST', body: JSON.stringify({ parentId, sitterId }) });
                    return res.suggestions || [];
                }catch(e){ return []; }
            }
            function showRebookingModal(parentId){
                const modal = document.createElement('div');
                modal.style.cssText = 'position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:999; display:flex; align-items:center; justify-content:center;';
                modal.innerHTML = '<div style="background:white; padding:30px; border-radius:15px; max-width:400px;"><h2 style="color:#FF69B4; margin-bottom:20px;">🔄 Rebook Favorites</h2><p style="margin-bottom:20px; color:#666;">Based on your booking history:</p><div id="rebooking-suggestions" style="margin-bottom:20px;"></div><button onclick="NR_Rebooking.closeRebooking()" style="background:#ccc; color:#666; padding:10px 20px; border:none; border-radius:8px; cursor:pointer;">Close</button></div>';
                document.body.appendChild(modal);
                window.NR_RebookingModal = modal;
                getSuggestions(parentId, 'sitter-1').then(suggestions => {
                    const container = document.getElementById('rebooking-suggestions');
                    if(suggestions.length){
                        container.innerHTML = suggestions.map(s => '<div style="padding:15px; border:2px solid #FF69B4; border-radius:8px; margin-bottom:10px; cursor:pointer;" onclick="NR_Rebooking.createRebooking(\''+parentId+'\',\''+s.sitterId+'\',\''+s.suggestedTimes[0]+'\')"><strong>Sitter '+s.sitterId+'</strong><br><small>'+s.reason+' ('+Math.round(s.confidence*100)+'% match)</small><br><em>'+new Date(s.suggestedTimes[0]).toLocaleString()+'</em></div>').join('');
                    } else {
                        container.innerHTML = '<p style="color:#666;">No rebooking suggestions available</p>';
                    }
                });
            }
            async function createRebooking(parentId, sitterId, startTime){
                try{
                    const res = await api('/api/rebooking/create', { method:'POST', body: JSON.stringify({ parentId, sitterId, startTime, duration: 4 }) });
                    NR_UI.toast('Rebooking created successfully!', 'success');
                    closeRebooking();
                }catch(e){ NR_UI.toast('Rebooking failed', 'error'); }
            }
            function closeRebooking(){ if(window.NR_RebookingModal){ document.body.removeChild(window.NR_RebookingModal); window.NR_RebookingModal = null; } }
            return { getSuggestions, showRebookingModal, createRebooking, closeRebooking };
        })();

        const NR_TrustScore = (function(){
            async function getTrustScore(sitterId){
                try{
                    const res = await api('/api/trust/'+sitterId);
                    return res.trustScore || 75;
                }catch(e){ return 75; }
            }
            function displayTrustScore(sitterId, containerId){
                getTrustScore(sitterId).then(score => {
                    const container = document.getElementById(containerId);
                    if(container){
                        const color = score >= 90 ? '#4CAF50' : score >= 75 ? '#FF9800' : '#F44336';
                        container.innerHTML = '<div style="display:inline-flex; align-items:center; padding:5px 10px; background:'+color+'; color:white; border-radius:15px; font-size:0.9em;"><span style="margin-right:5px;">🛡️</span>Trust Score: '+score+'</div>';
                    }
                });
            }
            async function updateTrustScore(sitterId, metrics){
                try{
                    const res = await api('/api/trust/update', { method:'POST', body: JSON.stringify({ sitterId, metrics }) });
                    return res.trustScore;
                }catch(e){ return 75; }
            }
            return { getTrustScore, displayTrustScore, updateTrustScore };
        })();

        const NR_AIAssistant = (function(){
            let chatHistory = [];
            function showAIChat(){
                const modal = document.createElement('div');
                modal.style.cssText = 'position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:999; display:flex; align-items:center; justify-content:center;';
                modal.innerHTML = '<div style="background:white; padding:20px; border-radius:15px; max-width:400px; height:500px; display:flex; flex-direction:column;"><h2 style="color:#6C63FF; margin-bottom:15px;">🤖 AI Booking Assistant</h2><div id="chat-messages" style="flex:1; overflow-y:auto; border:1px solid #ddd; border-radius:8px; padding:10px; margin-bottom:15px;"></div><div style="display:flex; gap:10px;"><input type="text" id="chat-input" placeholder="Ask me about booking..." style="flex:1; padding:10px; border:2px solid #ddd; border-radius:8px;"><button onclick="NR_AIAssistant.sendMessage()" style="background:#6C63FF; color:white; padding:10px 15px; border:none; border-radius:8px; cursor:pointer;">Send</button></div><button onclick="NR_AIAssistant.closeChat()" style="background:#ccc; color:#666; padding:8px 15px; border:none; border-radius:8px; cursor:pointer; margin-top:10px;">Close</button></div>';
                document.body.appendChild(modal);
                window.NR_ChatModal = modal;
                addMessage('assistant', "Hi! I'm your AI booking assistant. How can I help you today?");
                document.getElementById('chat-input').addEventListener('keypress', e => { if(e.key==='Enter') sendMessage(); });
            }
            function addMessage(sender, text){
                const container = document.getElementById('chat-messages');
                if(container){
                    const isUser = sender === 'user';
                    const msgDiv = document.createElement('div');
                    msgDiv.style.cssText = 'margin-bottom:10px; padding:10px; border-radius:10px; '+(isUser ? 'background:#6C63FF; color:white; margin-left:20px;' : 'background:#f0f0f0; margin-right:20px;');
                    msgDiv.textContent = text;
                    container.appendChild(msgDiv);
                    container.scrollTop = container.scrollHeight;
                }
            }
            async function sendMessage(){
                const input = document.getElementById('chat-input');
                const message = input.value.trim();
                if(!message) return;
                input.value = '';
                addMessage('user', message);
                chatHistory.push({ role: 'user', content: message });
                try{
                    const res = await api('/api/ai-assistant/chat', { method:'POST', body: JSON.stringify({ message, context: { history: chatHistory } }) });
        const NR_Voice = (function(){
            let recognition = null;
            let isListening = false;
            function startVoice(){
                if(!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)){
                    NR_UI.toast('Voice not supported in this browser', 'error'); return;
                }
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = false; recognition.interimResults = false; recognition.lang = 'en-US';
                recognition.onstart = () => { isListening = true; NR_UI.toast('🎤 Listening...', 'info'); };
                recognition.onresult = async (event) => {
                    const transcript = event.results[0][0].transcript;
                    try{
                        const res = await api('/api/voice/process', { method:'POST', body: JSON.stringify({ transcript }) });
                        NR_UI.toast('🗣️ '+res.response, 'success');
                        if(res.action === 'show_booking') NR_SmartScheduler.showSchedulerModal('sitter-1');
                        else if(res.action === 'show_cancellation') NR_Cancellation.showCancelModal('demo-booking');
                        else if(res.action === 'emergency_mode') NR_Emergency.triggerPanic();
                        else if(res.action === 'show_tip') NR_TipJar.showTipScreen('demo-session','sitter-1','parent-1');
                    }catch(e){ NR_UI.toast('Voice processing failed', 'error'); }
                };
                recognition.onerror = () => { NR_UI.toast('Voice recognition error', 'error'); isListening = false; };
                recognition.onend = () => { isListening = false; };
                recognition.start();
            }
            function stopVoice(){ if(recognition && isListening){ recognition.stop(); isListening = false; } }
            return { startVoice, stopVoice, isListening: () => isListening };
        })();

        const NR_Admin = (function(){
            function showAdminDashboard(){
                const modal = document.createElement('div');
                modal.style.cssText = 'position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:999; display:flex; align-items:center; justify-content:center;';
                modal.innerHTML = '<div style="background:white; padding:30px; border-radius:15px; max-width:600px; max-height:80vh; overflow-y:auto;"><h2 style="color:#E74C3C; margin-bottom:20px;">🛡️ Admin Dashboard</h2><div style="display:flex; gap:15px; margin-bottom:20px;"><button onclick="NR_Admin.loadFlags()" style="background:#E74C3C; color:white; padding:10px 15px; border:none; border-radius:8px; cursor:pointer;">View Flags</button><button onclick="NR_Admin.loadLogs()" style="background:#6C63FF; color:white; padding:10px 15px; border:none; border-radius:8px; cursor:pointer;">Activity Logs</button><button onclick="NR_Admin.closeAdmin()" style="background:#ccc; color:#666; padding:10px 15px; border:none; border-radius:8px; cursor:pointer;">Close</button></div><div id="admin-content" style="min-height:300px; border:1px solid #ddd; border-radius:8px; padding:15px;"></div></div>';
                document.body.appendChild(modal);
                window.NR_AdminModal = modal;
                loadFlags();
            }
            async function loadFlags(){
                try{
                    const res = await api('/api/admin/flags');
                    const container = document.getElementById('admin-content');
                    if(res.flags.length){
                        container.innerHTML = '<h3>Flagged Content</h3>'+res.flags.map(f => '<div style="padding:10px; border:1px solid #ddd; border-radius:5px; margin-bottom:10px;"><strong>'+f.type.toUpperCase()+'</strong> - '+f.reason+'<br><small>Reported: '+new Date(f.createdAt).toLocaleString()+' | Status: '+f.status+'</small></div>').join('');
                    } else {
                        container.innerHTML = '<p style="color:#666;">No flags to review</p>';
                    }
                }catch(e){ document.getElementById('admin-content').innerHTML = '<p style="color:red;">Failed to load flags</p>'; }
            }
            async function loadLogs(){
                try{
                    const res = await api('/api/admin/activity-logs');
                    const container = document.getElementById('admin-content');
                    if(res.logs.length){
                        container.innerHTML = '<h3>Activity Logs</h3>'+res.logs.map(l => '<div style="padding:8px; border-bottom:1px solid #eee;"><strong>'+l.agent+'</strong> - '+l.action+' '+(l.success?'✅':'❌')+'<br><small>'+new Date(l.timestamp).toLocaleString()+'</small></div>').join('');
                    } else {
                        container.innerHTML = '<p style="color:#666;">No activity logs</p>';
                    }
                }catch(e){ document.getElementById('admin-content').innerHTML = '<p style="color:red;">Failed to load logs</p>'; }
            }
            function closeAdmin(){ if(window.NR_AdminModal){ document.body.removeChild(window.NR_AdminModal); window.NR_AdminModal = null; } }
            return { showAdminDashboard, loadFlags, loadLogs, closeAdmin };
        })();

        const NR_Promos = (function(){
            function showPromoModal(){
                const modal = document.createElement('div');
                modal.style.cssText = 'position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:999; display:flex; align-items:center; justify-content:center;';
                modal.innerHTML = '<div style="background:white; padding:30px; border-radius:15px; max-width:350px; text-align:center;"><h2 style="color:#FF9800; margin-bottom:20px;">🎟️ Promo Code</h2><input type="text" id="promo-code" placeholder="Enter promo code" style="width:100%; padding:12px; border:2px solid #ddd; border-radius:8px; margin-bottom:15px; text-transform:uppercase;"><div style="display:flex; gap:10px;"><button onclick="NR_Promos.validatePromo()" style="flex:1; background:#FF9800; color:white; padding:12px; border:none; border-radius:8px; cursor:pointer;">Apply Code</button><button onclick="NR_Promos.closePromo()" style="background:#ccc; color:#666; padding:12px 20px; border:none; border-radius:8px; cursor:pointer;">Cancel</button></div></div>';
                document.body.appendChild(modal);
                window.NR_PromoModal = modal;
            }
            async function validatePromo(){
                const code = document.getElementById('promo-code').value.trim();
                if(!code){ NR_UI.toast('Please enter a promo code', 'warning'); return; }
                try{
                    const res = await api('/api/promos/validate', { method:'POST', body: JSON.stringify({ code, amount: 100 }) });
                    NR_UI.toast('Promo applied! Discount: $'+res.discount.toFixed(2), 'success');
                    closePromo();
                }catch(e){ NR_UI.toast('Invalid or expired promo code', 'error'); }
            }
            function closePromo(){ if(window.NR_PromoModal){ document.body.removeChild(window.NR_PromoModal); window.NR_PromoModal = null; } }
            return { showPromoModal, validatePromo, closePromo };
        })();

        const NR_Referrals = (function(){
            async function showReferralTree(userId){
                try{
                    const res = await api('/api/referrals/'+userId+'/tree');
                    const modal = document.createElement('div');
                    modal.style.cssText = 'position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:999; display:flex; align-items:center; justify-content:center;';
                    modal.innerHTML = '<div style="background:white; padding:30px; border-radius:15px; max-width:400px;"><h2 style="color:#4CAF50; margin-bottom:20px;">🌳 Referral Tree</h2><div style="text-align:center; margin-bottom:20px;"><div style="font-size:1.5em; font-weight:bold; color:#4CAF50;">$'+res.totalEarnings+'</div><div style="color:#666;">Total Earnings</div><div style="margin-top:10px; font-weight:bold;">'+res.totalReferrals+' Referrals</div></div><div style="max-height:200px; overflow-y:auto;">'+res.referrals.map(r => '<div style="padding:10px; border:1px solid #ddd; border-radius:5px; margin-bottom:8px;"><strong>'+r.type.toUpperCase()+'</strong> - '+r.refereeId+'<br><small>'+new Date(r.date).toLocaleDateString()+' | $'+r.earnings+'</small></div>').join('')+'</div><button onclick="NR_Referrals.closeReferrals()" style="background:#ccc; color:#666; padding:10px 20px; border:none; border-radius:8px; cursor:pointer; margin-top:15px;">Close</button></div>';
                    document.body.appendChild(modal);
                    window.NR_ReferralModal = modal;
                }catch(e){ NR_UI.toast('Failed to load referral tree', 'error'); }
            }
            function closeReferrals(){ if(window.NR_ReferralModal){ document.body.removeChild(window.NR_ReferralModal); window.NR_ReferralModal = null; } }
            return { showReferralTree, closeReferrals };
        })();
                    addMessage('assistant', res.response);
                    chatHistory.push({ role: 'assistant', content: res.response });
                }catch(e){ addMessage('assistant', 'Sorry, I had trouble processing that. Please try again.'); }
            }
            function closeChat(){ if(window.NR_ChatModal){ document.body.removeChild(window.NR_ChatModal); window.NR_ChatModal = null; } chatHistory = []; }
            return { showAIChat, addMessage, sendMessage, closeChat };
        })();
                const shared = loadShared();
                document.getElementById('sd-shared').textContent = shared.length? shared.map(s=>s.contact).join(', ') : 'none';
                const list = document.getElementById('sd-events');
                if(list){
                    list.innerHTML = '';
                    // server events (if any)
                    const srv = await (async function(){
                        try{
                            const ss = loadSession(); if(!ss || !ss.id || ss.id==='demo-1') return [];
                            const r = await fetch(NR_Config.serverBaseUrl+`/api/sessions/${ss.id}/events`);
                            if(!r.ok) return [];
                            const j = await r.json();
                            return Array.isArray(j.events)? j.events : [];
                        }catch(_){ return []; }
                    })();
                    srv.slice(0,10).forEach(e=>{ const div=document.createElement('div'); const ts=new Date(e.ts).toLocaleTimeString(); div.textContent=`${ts} • ${e.type}`; list.appendChild(div); });
                    // client-only notes
                    loadEvents().forEach(e=>{ const div=document.createElement('div'); div.textContent=`${e.ts} • ${e.type}: ${e.msg}`; list.appendChild(div); });
                }
            }
            function open(){ const d=document.getElementById('session-drawer'); if(d){ d.style.display='block'; render(); } }
            function close(){ const d=document.getElementById('session-drawer'); if(d){ d.style.display='none'; } }
            function toggle(){ const d=document.getElementById('session-drawer'); if(!d) return; if(d.style.display==='block') close(); else open(); }
            function addNote(){ const el=document.getElementById('sd-note'); const v=(el&&el.value||'').trim(); if(!v){ NR_UI.toast('Enter a note', 'warning'); return; } addEvent('note', v); el.value=''; }
            function clear(){ try{ localStorage.removeItem(LS_EVENTS); }catch(_){} render(); }
            return { open, close, toggle, addEvent, render, addNote, clear };
        })();
        // Hook events from Check-In and Geo to the drawer
        (function(){
            // Patch NR_CheckIn methods to log events
            try{
                const originalSend = NR_CheckIn.sendCheckIn;
                NR_CheckIn.sendCheckIn = function(){ originalSend(); try{ NR_SessionDrawer.addEvent('check-in','Sitter sent check-in'); }catch(_){} };
                const originalStart = NR_CheckIn.startSession;
                NR_CheckIn.startSession = function(){ originalStart(); try{ NR_SessionDrawer.addEvent('start','Session started'); NR_SessionDrawer.render(); }catch(_){} };
                const originalStop = NR_CheckIn.stopSession;
                NR_CheckIn.stopSession = function(){ originalStop(); try{ NR_SessionDrawer.addEvent('stop','Session ended'); NR_SessionDrawer.render(); }catch(_){} };
            }catch(_){}
            // Hook missed check-in
            try{
                const originalToast = NR_UI.toast;
                NR_UI.toast = function(msg, type){
                    if(/Missed check-in/i.test(msg)) try{ NR_SessionDrawer.addEvent('missed','Missed check-in'); }catch(_){ }
                    if(/Geo-fence breached/i.test(msg)) try{ NR_SessionDrawer.addEvent('geofence','Fence breached'); }catch(_){ }
                    return originalToast(msg, type);
                };
            }catch(_){}
            // Keep drawer fresh
            setInterval(()=>{ try{ NR_SessionDrawer.render(); }catch(_){} }, 2000);
        })();

            function updateEndBookingVisibility(){
                const sitterBtn = document.getElementById('btn-end-booking-sitter');
                const parentBtn = document.getElementById('btn-end-booking-parent');
                const s = (function(){ try{ return JSON.parse(localStorage.getItem('nr-demo-session')||'null'); }catch(_){ return null; } })();
                const active = !!(s && s.status==='active');
                if(sitterBtn){ sitterBtn.hidden = !active; }
                if(parentBtn){ parentBtn.hidden = !active; }
            }

                }
            };

        })();
        // Keep sitter end booking visibility synced on load and when role view switches
        (function(){
            const sync = ()=>{ try{ if(window.NR_CheckIn) { NR_CheckIn.sendCheckIn; } }catch(_){} try{ if(typeof updateEndBookingVisibility==='function') updateEndBookingVisibility(); }catch(_){} };
            window.addEventListener('load', sync);
            document.addEventListener('DOMContentLoaded', sync);
            try{ const orig = window.__refreshDashboardRoleView; window.__refreshDashboardRoleView = function(){ if(typeof orig==='function') orig(); sync(); }; }catch(_){}
        })();

            const btnSitter = document.getElementById('btnSitter');
            const bind = (el, role)=>{
                if(!el) return;
                const handler = (e)=>{ e.preventDefault(); e.stopPropagation(); goToAuth(role); };
                el.addEventListener('click', handler, {passive:false});
                el.addEventListener('touchend', handler, {passive:false});
            };
            bind(btnGetStarted, 'parent');
            bind(btnSitter, 'sitter');
        });



        // Disable secondary keyboard nav handler
        document.addEventListener('keydown', function(e) {
            e.stopPropagation();
        }, true);

        // Safety fallback: ensure sitter onboarding functions exist globally
        (function(){
            if (typeof window.startSitterOnboarding !== 'function') {
                window.startSitterOnboarding = function(){
                    try {
                        const user = JSON.parse(localStorage.getItem('nr-demo-user')||'{}');
                        user.role = 'sitter';
                        user.isOnboarded = false;
                        localStorage.setItem('nr-demo-user', JSON.stringify(user));
                    } catch(e) {}
                    if (typeof window.__refreshDashboardRoleView === 'function') window.__refreshDashboardRoleView();
                    showScreenById('screen-10');
                };
            }
            if (typeof window.gotoSitterStep !== 'function') {
                window.gotoSitterStep = function(step){
                    const ok = step>1 ? validateSitterStep(step-1) : true;
                    if(!ok){ alert('Please complete the required fields (*) before continuing.'); return; }
                    const map = {1:'sitter-step-1',2:'sitter-step-2',3:'sitter-step-3',4:'sitter-step-4',5:'sitter-step-5',6:'sitter-step-6',7:'sitter-step-7',8:'sitter-step-8',9:'sitter-step-9',10:'sitter-step-10',11:'sitter-step-11',12:'sitter-step-12'};
                    showScreenById(map[step]);
                };
            }
            if (typeof window.finishSitterOnboarding !== 'function') {
                window.finishSitterOnboarding = function(){
                    try {
                        const user = JSON.parse(localStorage.getItem('nr-demo-user')||'{}');
                        user.isOnboarded = true;
                        localStorage.setItem('nr-demo-user', JSON.stringify(user));
                    } catch(e) {}
                    if (typeof window.__refreshSitterReminder === 'function') window.__refreshSitterReminder();
                    showScreenById('screen-2');
                };
            }
        })();
    </script>
</body>
</html>